<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ottri Page Editor</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- SortableJS for Drag and Drop -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
  <!-- html2canvas for image export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <!-- FileSaver.js for saving files -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Lato:wght@800;900&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Inter', sans-serif; }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #1e1b30; }
    ::-webkit-scrollbar-thumb { background: #4a3a8a; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #5f4ba7; }
    .editor-input { background-color: #2a2347; border: 1px solid #4a3a8a; color: #e0e0e0; }
    .editor-input:focus { outline: none; border-color: #9378ff; box-shadow: 0 0 0 2px rgba(147,120,255,0.5); }
    .editor-label { font-weight: 500; color: #a394ff; }
    .accordion-header { background-color: #2a2347; border-bottom: 1px solid #4a3a8a; transition: background-color 0.2s ease; }
    .accordion-header:hover { background-color: #352c5a; }
    .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.5s cubic-bezier(0,1,0,1); }
    .accordion-content.expanded { max-height: 10000px; transition: max-height 1s ease-in-out; }
    .chevron { transition: transform 0.3s ease; }
    .expanded .chevron { transform: rotate(180deg); }
    .drag-handle { cursor: grab; color: #9ca3af; }
    .drag-handle:active { cursor: grabbing; }
    .sortable-ghost { opacity: 0.4; background: #4a3a8a; border: 1px dashed #9378ff; }
    .item-visibility-toggle { color: #9ca3af; transition: color 0.2s ease; }
    .item-visibility-toggle.enabled { color: #818cf8; }
    .item-visibility-toggle:hover { color: #c7d2fe; }
  </style>
</head>
<body class="bg-[#110d24] text-white h-full flex flex-col md:flex-row overflow-hidden">

  <!-- ===== PASSWORD MODAL FOR THE EDITOR ITSELF ===== -->
  <div id="editor-password-modal" class="fixed inset-0 bg-black bg-opacity-90 items-center justify-center z-50 p-4 hidden">
    <div class="bg-[#110d24] border border-white/10 rounded-2xl p-8 max-w-sm w-full text-center shadow-2xl">
      <h2 class="text-2xl font-bold text-white">Editor Access</h2>
      <p class="mt-2 text-gray-400">Please enter the password to access the editor.</p>
      <input type="password" id="editor-password-input" class="mt-6 w-full bg-gray-900/50 border border-white/20 rounded-lg p-3 text-white text-center focus:ring-2 focus:ring-[#9378ff] focus:outline-none" placeholder="••••••••" autocomplete="current-password" />
      <p id="editor-password-error" class="text-red-400 text-sm mt-2 h-5"></p>
      <button id="editor-unlock-button" class="mt-4 w-full bg-[#9378ff] hover:bg-[#8162ff] text-white font-bold py-3 px-4 rounded-lg transition-all duration-200">Unlock</button>
    </div>
  </div>

  <!-- ===== LEFT PANEL: EDITOR CONTROLS ===== -->
  <aside id="editor-panel" class="w-full md:w-1/3 lg:w-1/4 h-1/2 md:h-full flex flex-col border-r border-gray-700/50">
    <div class="p-4 bg-[#1e1b30] border-b border-gray-700/50 flex justify-between items-center">
      <h1 class="text-xl font-bold">Page Editor</h1>
      <div class="flex items-center space-x-2">
        <button id="export-page-btn" title="Export as HTML" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 px-3 rounded-lg transition-colors">
          <i class="fas fa-download"></i> <span class="hidden lg:inline">Export Page</span>
        </button>
      </div>
    </div>
    <div id="editor-controls" class="flex-grow overflow-y-auto p-4 space-y-6"></div>
  </aside>

  <!-- ===== RIGHT PANEL: LIVE PREVIEW ===== -->
  <main class="w-full md:w-2/3 lg:w-3/4 h-1/2 md:h-full flex-grow">
    <iframe id="preview-frame" class="w-full h-full border-0"></iframe>
  </main>

  <!-- ===== PAGE TEMPLATE RENDERED IN IFRAME ===== -->
  <template id="page-template">
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="utf-8" />
      <title>Ottri Investor Update</title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Lato:wght@800;900&display=swap" rel="stylesheet" />
      <script src="https://cdn.tailwindcss.com"></script>
      <link rel="preload" as="font" href="L-7%20Stencil.ttf" type="font/ttf" crossorigin />
      <style>
        @font-face { font-family: "L7Stencil"; src: url("L-7%20Stencil.ttf") format("truetype"); font-display: swap; font-weight: 400; font-style: normal; }
        html { min-height: 100%; color-scheme: dark; }
        html, body { height: 100%; }
        body { font-family: "Inter", sans-serif; color: #ffffff; background: transparent; }
        .section-eyebrow { color: #9378ff; font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase; }
        .title-gradient { background: linear-gradient(90deg, #F97316, #D946EF, #8B5CF6); -webkit-background-clip: text; background-clip: text; color: transparent; }
        .section-separator { position: relative; }
        .section-separator::before { content: ""; position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 90%; max-width: 1280px; border-top: 1px solid rgba(255,255,255,0.1); }
        .hero-title, .section-title { font-family: "Lato", sans-serif; font-weight: 800; -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility; }
        .initial { font-family: "L7Stencil", "Lato", sans-serif; font-weight: 700; filter: drop-shadow(0.35px 0 0 currentColor) drop-shadow(-0.35px 0 0 currentColor) drop-shadow(0 0.35px 0 currentColor) drop-shadow(0 -0.35px 0 currentColor) drop-shadow(0.25px 0.25px 0 currentColor) drop-shadow(-0.25px 0.25px 0 currentColor) drop-shadow(0.25px -0.25px 0 currentColor) drop-shadow(-0.25px -0.25px 0 currentColor); }
        p.text-indigo-300 { white-space: pre-line; }
        .kpi-widget { --hover-gradient: linear-gradient(120deg, #8B5CF6, #A78BFA); background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02)); backdrop-filter: blur(12px); border-radius: 1rem; padding: 1.5rem; border: 1px solid rgba(255,255,255,0.1); position: relative; overflow: hidden; transition: transform .3s ease, box-shadow .3s ease; }
        .kpi-widget:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
        .kpi-widget::before { content: ""; position: absolute; inset: 0; border-radius: 1rem; padding: 2px; background: var(--hover-gradient); -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); -webkit-mask-composite: destination-out; mask-composite: exclude; opacity: 0; transition: opacity .4s ease-in-out; }
        .kpi-widget:hover::before { opacity: 1; }
        .kpi-icon { width: 2rem; height: 2rem; display:flex; align-items:center; justify-content:center; border-radius:.5rem; background: rgba(139,92,246,0.10); box-shadow: 0 0 0 1px rgba(255,255,255,0.08) inset; }
        .kpi-icon img, .kpi-icon svg { width: 1.1rem; height: 1.1rem; opacity: .9; filter: drop-shadow(0 0 6px rgba(147,120,255,.35)); }
        .kpi-widget--takeover { --hover-gradient: linear-gradient(120deg, #8B5CF6, #D946EF); background: linear-gradient(120deg, #8B5CF6, #D946EF, #030014, #030014); background-size: 300% 300%; animation: animated-gradient 12s ease infinite; }
        @keyframes animated-gradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .kpi-widget--featured { background: linear-gradient(145deg, rgba(139, 92, 246, 0.1), rgba(139, 92, 246, 0.03)); }
        .kpi-widget--featured:hover { transform: translateY(-8px) scale(1.02); }
        .kpi-widget--highlight { --hover-gradient: linear-gradient(120deg, #F97316, #F59E0B, #D97706); }
        .kpi-widget--highlight .kpi-icon { background: rgba(249, 115, 22, 0.15); }
        .kpi-widget--highlight .kpi-icon svg, .kpi-widget--highlight .kpi-icon img { filter: drop-shadow(0 0 6px rgba(249, 115, 22, 0.45)); }
        .kpi-widget--highlight h3 { color: #FDBA74; }
        .kpi-widget--highlight p:not(.text-4xl) { color: #FCD34D; }
        .kpi-widget--custom { --widget-accent-color: #8B5CF6; --hover-gradient: linear-gradient(120deg, var(--widget-accent-color), color-mix(in srgb, var(--widget-accent-color) 70%, white)); background: linear-gradient(145deg, color-mix(in srgb, var(--widget-accent-color) 12%, #030014), color-mix(in srgb, var(--widget-accent-color) 5%, #030014)); }
        .kpi-widget--custom h3 { color: color-mix(in srgb, var(--widget-accent-color) 70%, #FFFFFF); }
        .kpi-widget--custom p:not(.text-4xl) { color: color-mix(in srgb, var(--widget-accent-color) 50%, #FFFFFF); }
        .kpi-widget--custom .kpi-icon { background-color: color-mix(in srgb, var(--widget-accent-color) 20%, transparent); }
        .kpi-widget--custom .kpi-icon svg, .kpi-widget--custom .kpi-icon img { filter: drop-shadow(0 0 6px var(--widget-accent-color)); }
        .iphone-mockup { position: relative; width: 280px; height: 573px; margin: 0 auto; background-color: #1a1a1a; border-radius: 44px; border: 1px solid #444; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5), inset 0 0 10px rgba(0,0,0,0.6); padding: 14px; transition: transform 0.3s ease, box-shadow 0.3s ease; transform-origin: center 30px; will-change: transform; }
        .iphone-mockup:hover { transform: translateY(-10px) scale(1.02); box-shadow: 0 35px 60px -15px rgba(147, 120, 255, 0.3); }
        .iphone-screen { background-color: #000; width: 100%; height: 100%; border-radius: 30px; overflow: hidden; position: relative; }
        .iphone-screen img, .iphone-screen iframe { width: 100%; height: 100%; object-fit: cover; border: none; display: block; }
        .iphone-notch { position: absolute; top: 14px; left: 50%; transform: translateX(-50%); width: 140px; height: 24px; background-color: #1a1a1a; border-radius: 0 0 16px 16px; z-index: 2; pointer-events: none; }
        .scroll-container { -ms-overflow-style: none; scrollbar-width: none; }
        .scroll-container::-webkit-scrollbar { display: none; }
      </style>
    </head>
    <body class="antialiased" style="overflow: hidden;">
      <!-- Content will be injected here by editor -->
    </body>
    </html>
  </template>

<script>
// ===================================================================================
// DATA STORE (full content)
// ===================================================================================
let pageData = {
  security: { id: 'security', title: 'Security', passwords: [] },
  globalStyles: {
    backgroundColor: '#030014',
    gradient1Color: 'rgba(76,36,159,0.35)',
    gradient1Position: '15% -10%',
    gradient2Color: 'rgba(217,70,239,0.20)',
    gradient2Position: '85% 0%',
    baseTextColor: '#FFFFFF',
    eyebrowColor: '#9378ff',
    primaryFont: 'Inter',
    titleFont: 'Lato'
  },
  hero: {
    id: 'hero', title: 'Hero Section', enabled: true,
    logoUrl: 'https://uploads-ssl.webflow.com/642f4c34a34b0752838a1672/64483a9925239e32a6730071_ottri-logo-p-500.png',
    titleText: 'The Future of *Operational* AI is Here.',
    subtitleText: 'This is the Q4 2025 investor update for Ottri. We\'re excited to share our progress and vision for the future.'
  },
  team: {
    id: 'team', title: 'Team Section', enabled: true,
    eyebrowText: 'Our Crew', titleText: 'Meet the *Innovators*',
    descriptionText: 'A dedicated team of builders, dreamers, and strategists turning vision into reality.',
    members: [
      { id: 'tm1', name: 'Alex Johnson', title: 'CEO & Founder', bio: 'Visionary leader with 20+ years in tech, driving the future of AI operations.', imageUrl: 'https://i.pravatar.cc/256?u=alex', enabled: true },
      { id: 'tm2', name: 'Brenda Smith', title: 'Chief Technology Officer', bio: 'Architect of our platform, turning complex problems into elegant solutions.', imageUrl: 'https://i.pravatar.cc/256?u=brenda', enabled: true },
      { id: 'tm3', name: 'Charles Lee', title: 'VP of Product', bio: 'Expert in user-centric design, ensuring our product solves real-world challenges.', imageUrl: 'https://i.pravatar.cc/256?u=charles', enabled: true }
    ]
  },
  momentum: {
    id: 'momentum', title: 'Momentum / Stats', enabled: true,
    eyebrowText: 'Traction', titleText: 'By the *Numbers*',
    descriptionText: 'Our key performance indicators reflect strong growth and market validation.',
    stats: [
      { id: 'st1', value: '1,200%', title: 'User Growth', body: 'Exponential increase in active users over the last quarter.', enabled: true },
      { id: 'st2', value: '$2.1M', title: 'ARR', body: 'Annual Recurring Revenue, up 300% from the previous period.', enabled: true },
      { id: 'st3', value: '98%', title: 'Customer Retention', body: 'Demonstrating extreme product stickiness and satisfaction.', enabled: true }
    ]
  },
  market: {
    id: 'market', title: 'Market / ROI', enabled: true,
    eyebrowText: 'Market Opportunity', titleText: 'Capturing a *Growing* Market',
    descriptionText: 'We are positioned to lead in a rapidly expanding industry.',
    tiles: [
      { id: 'mkt1', title: 'Total Addressable Market', body: 'The global market for AI in operations is projected to explode.', value: '$50B', badgeText: '+25% CAGR', badgeTone: 'green', icon: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18L9 11.25l4.306 4.307a11.95 11.95 0 015.814-5.519l2.74-1.22m0 0l-3.75-.625m3.75.625V3.375" /></svg>', style: 'featured', enabled: true },
      { id: 'mkt2', title: 'Return on Investment', body: 'Customers see an average 5x ROI within the first year of implementation.', value: '5x', badgeText: 'High Value', badgeTone: 'blue', icon: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>', style: 'default', enabled: true },
      { id: 'mkt3', title: 'Strategic Moat', body: 'Our proprietary data models and partner integrations create a strong competitive advantage.', value: 'Protected', badgeText: 'Proprietary Tech', badgeTone: 'violet', icon: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.286zm0 13.036h.008v.008h-.008v-.008z" /></svg>', style: 'default', enabled: true },
      { id: 'mkt4', title: 'Q1 2026 Goal: 10,000 Customers', body: 'Aggressive expansion plans are underway to scale our customer base significantly in the next fiscal year.', value: '10k', badgeText: 'Next Target', badgeTone: 'amber', icon: '<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.59 14.37a6 6 0 01-5.84 7.38v-4.82m5.84-2.56a17.96 17.96 0 00-5.84-2.56m0 0a17.96 17.96 0 01-5.84 2.56m5.84-2.56V4.5" /></svg>', style: 'highlight', enabled: true }
    ]
  },
  product: {
    id: 'product', title: 'Product Section', enabled: true,
    eyebrowText: 'The Platform', titleText: 'See it in *Action*',
    descriptionText: 'Interactive demos and screenshots of our core product offering.',
    links: [
      { id: 'pl1', url: 'https://images.unsplash.com/photo-1581291518857-4e27b48ff24e?q=80&w=1000', enabled: true },
      { id: 'pl2', url: 'https://images.unsplash.com/photo-1555774698-0b77e0abfe79?q=80&w=1000', enabled: true },
      { id: 'pl3', url: 'https://images.unsplash.com/photo-1618761714954-0b8cd0026356?q=80&w=1000', enabled: true }
    ]
  },
  vision: {
    id: 'vision', title: 'Vision Section', enabled: true,
    eyebrowText: 'Our Vision', titleText: 'The *Future* is Autonomous',
    descriptionText: 'We believe in a future where operational tasks are fully automated, freeing humans to focus on high-level strategy and creativity.',
    bodyText: 'Our roadmap leads to a fully autonomous operational AI that can predict needs, solve problems, and optimize workflows without human intervention. This is the future we are building.'
  },
  footer: {
    id: 'footer', title: 'Footer Section', enabled: true,
    eyebrowText: 'Next Steps',
    bodyText: 'Thank you for your time. We welcome any questions and look forward to our continued partnership.\nConfidential & Proprietary. © 2025 Ottri, Inc.'
  }
};

const orderedSections = ['security','globalStyles','hero','team','momentum','market','product','vision','footer'];

// ===================================================================================
// UTILS & RENDERERS
// ===================================================================================
const $ = function(sel){ return document.querySelector(sel); };
const GRADIENT_RE = /\*(.*?)\*/g;
function applyGradient(text){ return (!text || typeof text !== 'string') ? '' : text.replace(GRADIENT_RE, '<span class="title-gradient">$1</span>'); }
function wrapInitial(el){ if(!el) return; var walker = document.createTreeWalker(el, NodeFilter.SHOW_TEXT, { acceptNode: function(n){ return (n.nodeValue && n.nodeValue.trim().length) ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP; } }); var firstText = walker.nextNode(); if(!firstText) return; var s = firstText.nodeValue; var i = s.search(/\S/); if(i === -1) return; var before = s.slice(0,i); var first = s[i]; var after = s.slice(i+1); var span = document.createElement('span'); span.className = 'initial'; span.textContent = first; var frag = document.createDocumentFragment(); frag.appendChild(document.createTextNode(before)); frag.appendChild(span); frag.appendChild(document.createTextNode(after)); firstText.parentNode.replaceChild(frag, firstText); }

function renderHeroSection(d){ var h = '<div class="text-center py-16 sm:py-20 px-6 lg:px-8">'; if(d.logoUrl) h += '<img class="max-h-48 w-auto mx-auto mb-8" src="'+d.logoUrl+'" alt="Ottri Logo" />'; if(d.titleText) h += '<h1 class="hero-title text-4xl font-bold tracking-tight sm:text-6xl leading-snug sm:leading-snug">'+applyGradient(d.titleText)+'</h1>'; if(d.subtitleText) h += '<p class="mt-4 text-lg leading-8 text-gray-300">'+applyGradient(d.subtitleText)+'</p>'; h += '</div>'; return h; }

function renderStandardSection(d){ var h = '<div class="max-w-4xl mx-auto text-center py-16 sm:py-24 px-6 lg:px-8">'; if(d.eyebrowText) h += '<p class="section-eyebrow mb-4">'+applyGradient(d.eyebrowText)+'</p>'; if(d.titleText) h += '<h2 class="section-title text-4xl md:text-5xl font-extrabold tracking-tight">'+applyGradient(d.titleText)+'</h2>'; if(d.descriptionText) h += '<p class="mt-4 max-w-3xl mx-auto text-lg text-gray-300">'+applyGradient(d.descriptionText)+'</p>'; if(d.bodyText){ var paras = d.bodyText.split('\n').filter(function(p){ return p.trim()!==''; }); paras.forEach(function(p){ h += '<p class="mt-6 max-w-2xl mx-auto text-lg text-gray-300 text-center">'+applyGradient(p)+'</p>'; }); } h += '</div>'; return h; }

function renderTeamSection(d){ var h = '<div class="max-w-6xl mx-auto text-center py-16 sm:py-24 px-6 lg:px-8">'; if(d.eyebrowText) h += '<p class="section-eyebrow mb-4">'+applyGradient(d.eyebrowText)+'</p>'; if(d.titleText) h += '<h2 class="section-title text-4xl md:text-5xl font-extrabold tracking-tight">'+applyGradient(d.titleText)+'</h2>'; if(d.descriptionText) h += '<p class="mt-4 max-w-3xl mx-auto text-lg text-gray-300">'+applyGradient(d.descriptionText)+'</p>'; if(d.members && d.members.length){ var grid = '<div class="mt-12 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">'; d.members.filter(function(m){ return m.enabled; }).forEach(function(m){ var initials = (m.name.split(' ').map(function(n){ return n[0]; }).join('') || '??').toUpperCase(); var ph = 'https://placehold.co/256x256/4B5563/FFFFFF?text='+encodeURIComponent(initials); var src = m.imageUrl || ph; grid += '<div class="text-center bg-gray-800/30 backdrop-blur-sm rounded-xl p-8 border border-white/10 h-full flex flex-col">'+ '<img class="w-32 h-32 rounded-full mx-auto object-cover mb-4 border-4 border-white/10" src="'+src+'" alt="'+m.name+'" onerror="this.onerror=null;this.src=\''+ph+'\';" />'+ '<h3 class="text-xl font-bold tracking-tight text-white">'+applyGradient(m.name)+'</h3>'+ (m.title ? '<p class="text-indigo-300">'+applyGradient(m.title)+'</p>' : '')+ '<div class="flex-1 mt-2">'+(m.bio ? '<p class="text-gray-400 text-sm">'+applyGradient(m.bio)+'</p>' : '')+'</div></div>'; }); grid += '</div>'; h += grid; } h += '</div>'; return h; }

function renderStatsSection(d){ var h = '<div class="max-w-5xl mx-auto text-center py-16 sm:py-24 px-6 lg:px-8">'; if(d.eyebrowText) h += '<p class="section-eyebrow mb-4">'+applyGradient(d.eyebrowText)+'</p>'; if(d.titleText) h += '<h2 class="section-title text-4xl md:text-5xl font-extrabold tracking-tight">'+applyGradient(d.titleText)+'</h2>'; if(d.descriptionText) h += '<p class="mt-4 max-w-3xl mx-auto text-lg text-gray-300">'+applyGradient(d.descriptionText)+'</p>'; if(d.stats && d.stats.length){ var grid = '<div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-8">'; d.stats.filter(function(s){ return s.enabled; }).forEach(function(s){ grid += '<div class="bg-gray-800/30 backdrop-blur-sm rounded-xl p-8 border border-white/10 text-center h-full flex flex-col justify-center">'+ (s.value ? '<p class="text-4xl md:text-5xl font-extrabold text-[#9378ff]">'+applyGradient(s.value)+'</p>' : '')+ (s.title ? '<h3 class="mt-2 text-lg font-semibold text-white">'+applyGradient(s.title)+'</h3>' : '')+ (s.body ? '<p class="mt-1 text-gray-400">'+applyGradient(s.body).replace(/\n/g,'<br/>')+'</p>' : '')+ '</div>'; }); grid += '</div>'; h += grid; } h += '</div>'; return h; }

function renderMarketSection(d){ function badgeClasses(tone){ var map = { green:{bg:'bg-green-500/20',text:'text-green-300'}, red:{bg:'bg-red-500/20',text:'text-red-300'}, blue:{bg:'bg-blue-500/20',text:'text-blue-300'}, violet:{bg:'bg-violet-500/20',text:'text-violet-300'}, amber:{bg:'bg-amber-500/20',text:'text-amber-200'}, gray:{bg:'bg-white/10',text:'text-gray-300'} }; return map[String(tone||'').toLowerCase()] || {bg:'bg-violet-500/20',text:'text-violet-300'}; } var h = '<div class="max-w-7xl mx-auto text-center py-16 sm:py-24 px-6 lg:px-8">'; if(d.eyebrowText) h += '<p class="section-eyebrow mb-4">'+applyGradient(d.eyebrowText)+'</p>'; if(d.titleText) h += '<h2 class="section-title text-4xl md:text-5xl font-extrabold tracking-tight">'+applyGradient(d.titleText)+'</h2>'; if(d.descriptionText) h += '<p class="mt-4 max-w-3xl mx-auto text-lg text-gray-300">'+applyGradient(d.descriptionText)+'</p>'; if(d.tiles && d.tiles.length){ var grid = '<div class="mt-16 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 text-left">'; d.tiles.filter(function(t){ return t.enabled; }).forEach(function(t){ var badge = t.badgeText ? (function(){ var c = badgeClasses(t.badgeTone); return '<span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium '+c.bg+' '+c.text+'">'+applyGradient(t.badgeText)+'</span>'; })() : ''; var widgetClasses = 'kpi-widget flex flex-col'; var styleAttr = ''; var styleLower = String(t.style||'').toLowerCase(); if(styleLower==='featured') widgetClasses += ' kpi-widget--featured'; else if(styleLower==='highlight') widgetClasses += ' kpi-widget--highlight'; else if(styleLower==='takeover') widgetClasses += ' kpi-widget--takeover'; else if(t.style && t.style !== 'default'){ widgetClasses += ' kpi-widget--custom'; styleAttr = 'style="--widget-accent-color: '+t.style+';"'; } var inner = '<div class="flex-grow flex flex-col justify-between"><div><div class="flex justify-between items-start"><h3 class="text-sm font-medium">'+applyGradient(t.title)+'</h3>'+ (t.icon ? '<div class="kpi-icon">'+t.icon+'</div>' : '') +'</div>'+ (t.value ? '<p class="mt-4 text-4xl font-extrabold text-white">'+applyGradient(t.value)+'</p>' : '') +'</div><div>'+ (badge ? '<div class="mt-2 flex items-center gap-2">'+badge+'</div>' : '') + (t.body ? '<p class="mt-4 text-gray-300">'+applyGradient(t.body)+'</p>' : '') +'</div></div>'; grid += '<div class="'+(styleLower==='takeover'?'lg:col-span-2':'')+'"><div class="'+widgetClasses+' h-full" '+styleAttr+'>'+inner+'</div></div>'; }); grid += '</div>'; h += grid; } h += '</div>'; return h; }

function renderProductSection(d){ var h = '<div class="max-w-7xl mx-auto text-center py-16 sm:py-24 px-6 lg:px-8">'; if(d.eyebrowText) h += '<p class="section-eyebrow mb-4">'+applyGradient(d.eyebrowText)+'</p>'; if(d.titleText) h += '<h2 class="section-title text-4xl md:text-5xl font-extrabold tracking-tight">'+applyGradient(d.titleText)+'</h2>'; if(d.descriptionText) h += '<p class="mt-4 max-w-3xl mx-auto text-lg text-gray-300">'+applyGradient(d.descriptionText)+'</p>'; if(d.links && d.links.length){ h += '<div class="mt-20 flex flex-nowrap lg:flex-wrap justify-start lg:justify-center items-center gap-x-8 gap-y-12 overflow-x-auto scroll-container pb-8 -mx-6 px-6">'; d.links.filter(function(l){ return l.enabled; }).forEach(function(link, idx){ h += '<div class="iphone-mockup flex-shrink-0"><div class="iphone-notch"></div><div class="iphone-screen"><img src="'+link.url+'" alt="Platform Screenshot '+(idx+1)+'" onerror="this.onerror=null;this.src=\'https://placehold.co/375x812/030014/9378ff?text=Image+Failed\';"></div></div>'; }); h += '</div>'; } h += '</div>'; return h; }

function renderFooterSection(d){ var h = '<div class="py-16 sm:py-24 px-6 lg:px-8"><div class="max-w-4xl mx-auto text-center">'; if(d.eyebrowText) h += '<p class="section-eyebrow mb-4">'+applyGradient(d.eyebrowText)+'</p>'; if(d.bodyText) h += '<p class="mt-4 text-md text-gray-400">'+applyGradient(d.bodyText).replace(/\n/g,'<br/>')+'</p>'; h += '</div></div>'; return h; }

function renderPage(data){ var contentHtml = ''; var enabledSections = orderedSections.map(function(key){ return data[key]; }).filter(function(section){ if(!section) return false; if(section.id==='globalStyles' || section.id==='security') return true; return section.enabled; }); for(var idx=0; idx<enabledSections.length; idx++){ var section = enabledSections[idx]; if(!section.id) continue; var sectionHtml = ''; switch(section.id){ case 'hero': sectionHtml = renderHeroSection(section); break; case 'team': sectionHtml = renderTeamSection(section); break; case 'momentum': sectionHtml = renderStatsSection(section); break; case 'market': sectionHtml = renderMarketSection(section); break; case 'product': sectionHtml = renderProductSection(section); break; case 'footer': sectionHtml = renderFooterSection(section); break; default: if(section.id!=='globalStyles' && section.id!=='security'){ sectionHtml = renderStandardSection(section); } } if(sectionHtml){ contentHtml += '<div id="section-'+section.id+'" class="section-wrapper '+(section.id!=='footer'?'section-separator':'')+'">'+sectionHtml+'</div>'; } } return '<div class="content-wrapper">'+contentHtml+'</div>'; }

// ===================================================================================
// EDITOR UI LOGIC (full controls, sortable, item-level controls)
// ===================================================================================
const editorControls = $('#editor-controls');
let sortableInstances = [];

function createInput(label, type, value, path, extraAttrs){ if(extraAttrs==null) extraAttrs=''; var id = 'editor-' + path.replace(/\./g,'-'); var labelHtml = '<label for="'+id+'" class="editor-label text-sm">'+label+'</label>'; var v = (value!=null? value : ''); var inputHtml; if(type==='textarea'){ inputHtml = '<textarea id="'+id+'" data-path="'+path+'" class="editor-input mt-1 block w-full rounded-md shadow-sm p-2 text-sm" rows="3" '+extraAttrs+'>'+v+'</textarea>'; } else { inputHtml = '<input type="'+type+'" id="'+id+'" value="'+v+'" data-path="'+path+'" class="editor-input '+(type==='color'?'h-10 p-1':'p-2')+' mt-1 block w-full rounded-md shadow-sm text-sm" '+extraAttrs+'>'; } return '<div class="mb-4">'+labelHtml+inputHtml+'</div>'; }

function createToggle(label, checked, path){ var id = 'editor-' + path.replace(/\./g,'-'); return '<div class="flex items-center justify-between mb-4 bg-gray-800/30 p-3 rounded-lg"><span class="font-medium text-white">'+label+'</span><label for="'+id+'" class="inline-flex relative items-center cursor-pointer"><input type="checkbox" '+(checked?'checked':'')+' id="'+id+'" data-path="'+path+'" class="sr-only peer"><div class="w-11 h-6 bg-gray-600 rounded-full peer peer-focus:ring-2 peer-focus:ring-indigo-400 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[\'\'] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div></label></div>'; }

function createAccordion(title, content, sectionId, hasToggle, isDraggable){ if(isDraggable==null) isDraggable=false; var isEnabled = hasToggle ? (pageData[sectionId] && pageData[sectionId].enabled) : false; var dragHandle = isDraggable ? '<i class="fas fa-grip-vertical drag-handle mr-3 text-gray-500"></i>' : '<div class="w-5 mr-3"></div>'; return '<div class="bg-[#1e1b30] rounded-lg overflow-hidden border border-gray-700/50 section-accordion" data-section-id="'+sectionId+'"><div class="accordion-header p-4 cursor-pointer flex justify-between items-center"><div class="flex items-center">'+dragHandle+'<h3 class="text-lg font-semibold">'+title+'</h3></div><i class="fas fa-chevron-down chevron"></i></div><div class="accordion-content"><div class="p-4 border-t border-gray-700/50 space-y-4">'+(hasToggle? createToggle('Enable Section', isEnabled, sectionId+'.enabled') : '')+content+'</div></div></div>'; }

function createItemControls(sectionKey, item, index){ var controls = '<div class="bg-gray-800/50 p-3 rounded-lg border border-gray-700 space-y-3 relative item-control-wrapper" data-index="'+index+'"><div class="flex justify-between items-center pb-2 border-b border-gray-700"><i class="fas fa-grip-vertical drag-handle p-2"></i><div class="flex items-center space-x-3"><button class="item-visibility-toggle '+(item.enabled ? 'enabled':'')+'" data-path="'+sectionKey+'.'+index+'.enabled" title="Toggle visibility"><i class="fas '+(item.enabled? 'fa-eye':'fa-eye-slash')+'"></i></button><button class="text-red-400 hover:text-red-300 delete-item-btn" data-section="'+sectionKey+'" data-index="'+index+'" title="Delete item"><i class="fas fa-trash-alt"></i></button></div></div>'; Object.keys(item).forEach(function(key){ if(key==='id' || key==='enabled') return; var value = item[key]; var type = 'text'; var lower = String(key).toLowerCase(); if(lower.indexOf('url')!==-1 || lower.indexOf('image')!==-1) type='url'; else if(lower.indexOf('icon')!==-1) type='textarea'; else if(lower.indexOf('bio')!==-1 || lower.indexOf('body')!==-1 || (typeof value==='string' && value.length>50)) type='textarea'; var nice = key.replace(/([A-Z])/g,' $1').replace(/^./, function(c){ return c.toUpperCase(); }); controls += createInput(nice, type, value, sectionKey+'.'+index+'.'+key); }); controls += '</div>'; return controls; }

function renderEditorUI(){ sortableInstances.forEach(function(s){ if(s && s.destroy) s.destroy(); }); sortableInstances = []; var uiHtml = ''; // Security
 var securityData = pageData.security; var securityControls = ''; var passwordsString = (securityData.passwords||[]).join('\n'); securityControls += createInput('Passwords (one per line)','textarea',passwordsString,'security.passwords'); securityControls += '<p class="text-xs text-gray-400 mt-[-10px] mb-4">If empty, page will be public.</p>'; uiHtml += createAccordion(securityData.title,' '+securityControls,'security',false); // Global Styles
 var stylesData = pageData.globalStyles; var stylesControls=''; stylesControls += createInput('Background Color','color',stylesData.backgroundColor,'globalStyles.backgroundColor'); stylesControls += createInput('Gradient 1 Color','color',stylesData.gradient1Color,'globalStyles.gradient1Color'); stylesControls += createInput('Gradient 1 Position','text',stylesData.gradient1Position,'globalStyles.gradient1Position'); stylesControls += createInput('Gradient 2 Color','color',stylesData.gradient2Color,'globalStyles.gradient2Color'); stylesControls += createInput('Gradient 2 Position','text',stylesData.gradient2Position,'globalStyles.gradient2Position'); stylesControls += createInput('Base Text Color','color',stylesData.baseTextColor,'globalStyles.baseTextColor'); stylesControls += createInput('Eyebrow Text Color','color',stylesData.eyebrowColor,'globalStyles.eyebrowColor'); stylesControls += createInput('Primary Font','text',stylesData.primaryFont,'globalStyles.primaryFont'); stylesControls += createInput('Title Font','text',stylesData.titleFont,'globalStyles.titleFont'); uiHtml += createAccordion('Global Styles', stylesControls,'globalStyles',false);
 // Content Sections
 var contentSectionsHtml = '<div id="section-list-container">'; orderedSections.forEach(function(key){ if(key==='security' || key==='globalStyles') return; var sectionData = pageData[key]; if(!sectionData) return; var sectionControls = ''; if('eyebrowText' in sectionData) sectionControls += createInput('Eyebrow','text',sectionData.eyebrowText,key+'.eyebrowText'); if('titleText' in sectionData) sectionControls += createInput('Title','text',sectionData.titleText,key+'.titleText'); if('subtitleText' in sectionData) sectionControls += createInput('Subtitle','textarea',sectionData.subtitleText,key+'.subtitleText'); if('descriptionText' in sectionData) sectionControls += createInput('Description','textarea',sectionData.descriptionText,key+'.descriptionText'); if('bodyText' in sectionData) sectionControls += createInput('Body','textarea',sectionData.bodyText,key+'.bodyText'); if('logoUrl' in sectionData) sectionControls += createInput('Logo URL','url',sectionData.logoUrl,key+'.logoUrl'); var arrayKey = Object.keys(sectionData).find(function(k){ return Array.isArray(sectionData[k]); }); if(arrayKey){ sectionControls += '<hr class="border-gray-600 my-4"><h4 class="font-semibold mb-2">'+arrayKey.charAt(0).toUpperCase()+arrayKey.slice(1)+'</h4>'; var itemsHtml = '<div class="item-list-container space-y-4" data-section="'+key+'" data-array-key="'+arrayKey+'">'; var items = sectionData[arrayKey]; items.forEach(function(item, index){ itemsHtml += createItemControls(key+'.'+arrayKey, item, index); }); itemsHtml += '</div>'; sectionControls += itemsHtml; sectionControls += '<button class="mt-4 w-full bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-3 rounded-lg transition-colors add-item-btn" data-section="'+key+'" data-array-key="'+arrayKey+'"><i class="fas fa-plus"></i> Add New Item</button>'; }
 sectionControls += '<hr class="border-gray-600 my-4">' + '<div class="flex space-x-2">' + '<button class="export-section-png-btn w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-3 rounded-lg transition-colors" data-section-id="'+sectionData.id+'"><i class="fas fa-image"></i> PNG</button>' + '<button class="export-section-html-btn w-full bg-teal-600 hover:bg-teal-500 text-white font-bold py-2 px-3 rounded-lg transition-colors" data-section-id="'+sectionData.id+'"><i class="fas fa-code"></i> HTML</button>' + '</div>';
 contentSectionsHtml += createAccordion(sectionData.title, sectionControls, key, true, true); }); contentSectionsHtml += '</div>'; uiHtml += contentSectionsHtml; editorControls.innerHTML = uiHtml; initSortable(); }

// ===================================================================================
// EVENT HANDLING & PREVIEW
// ===================================================================================
function setNestedValue(obj, path, value){ var keys = path.split('.'); var current = obj; for(var i=0;i<keys.length-1;i++){ current = current[keys[i]]; } current[keys[keys.length-1]] = value; }

function handleInputChange(e){ var path = e.target.dataset.path; if(!path) return; var value; if(path==='security.passwords'){ value = e.target.value.split('\n').map(function(p){ return p.trim(); }).filter(function(p){ return p; }); } else if(e.target.type==='checkbox'){ value = e.target.checked; } else { value = e.target.value; } setNestedValue(pageData, path, value); updatePreview(); }

function handleItemVisibilityToggle(e){ var button = e.target.closest('.item-visibility-toggle'); if(!button) return; var path = button.dataset.path; var keys = path.split('.'); var lastKey = keys.pop(); var current = pageData; for(var i=0;i<keys.length;i++){ current = current[keys[i]]; } current[lastKey] = !current[lastKey]; var icon = button.querySelector('i'); button.classList.toggle('enabled'); if(icon){ icon.classList.toggle('fa-eye'); icon.classList.toggle('fa-eye-slash'); } updatePreview(); }

function handleAddItem(e){ var button = e.target.closest('.add-item-btn'); if(!button) return; var sectionKey = button.dataset.section; var arrayKey = button.dataset.arrayKey; var items = pageData[sectionKey][arrayKey]; if(items.length>0){ var newItem = JSON.parse(JSON.stringify(items[0])); Object.keys(newItem).forEach(function(key){ if(key==='id'){ newItem[key] = (key.slice(0,2))+Date.now(); } else if(typeof newItem[key] === 'string'){ newItem[key] = 'New Item'; } else if(typeof newItem[key] === 'boolean'){ newItem[key] = true; } }); items.push(newItem); renderEditorUI(); updatePreview(); } }

function handleDeleteItem(e){ var button = e.target.closest('.delete-item-btn'); if(!button) return; var sectionKey = button.dataset.section; var index = parseInt(button.dataset.index,10); var parts = sectionKey.split('.'); var section = parts[0]; var arrayKey = parts[1]; pageData[section][arrayKey].splice(index,1); renderEditorUI(); updatePreview(); }

function handleAccordionToggle(e){ var header = e.target.closest('.accordion-header'); if(!header) return; header.classList.toggle('expanded'); var content = header.nextElementSibling; content.classList.toggle('expanded'); }

function updatePreview(){ var frame = $('#preview-frame'); var template = $('#page-template'); var doc = document.createElement('html'); doc.innerHTML = template.innerHTML; var global = pageData.globalStyles; var styleTag = doc.querySelector('style'); styleTag.innerHTML += '\nhtml {\n  background: radial-gradient(1200px 600px at '+global.gradient1Position+', '+global.gradient1Color+' 0%, rgba(76,36,159,0) 45%), radial-gradient(1000px 500px at '+global.gradient2Position+', '+global.gradient2Color+' 0%, rgba(217,70,239,0) 50%), '+global.backgroundColor+';\n  background-repeat: no-repeat; background-attachment: fixed;\n}\nbody { color: '+global.baseTextColor+'; font-family: "'+global.primaryFont+'", sans-serif; }\n.hero-title, .section-title { font-family: "'+global.titleFont+'", sans-serif; }\n.section-eyebrow { color: '+global.eyebrowColor+'; }\n'; var body = doc.querySelector('body'); body.innerHTML = renderPage(pageData) + body.innerHTML; doc.querySelectorAll('.hero-title, .section-title').forEach(function(el){ wrapInitial(el); }); frame.srcdoc = doc.outerHTML; }

// ===================================================================================
// EXPORTS
// ===================================================================================
function exportSection(e, format){ var button = e.target.closest('button'); var sectionId = button ? button.dataset.sectionId : null; var previewDoc = $('#preview-frame').contentWindow ? $('#preview-frame').contentWindow.document : null; if(!sectionId || !previewDoc){ alert('Could not find section to export.'); return; } var element = previewDoc.getElementById('section-'+sectionId); if(!element){ alert('Could not find section to export.'); return; } if(format==='html'){ var styles = (previewDoc.querySelector('style')||{}).innerHTML || ''; var htmlContent = element.outerHTML; var fullHtml = '<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><script src="https://cdn.tailwindcss.com"></script><style>'+styles+'</style></head><body class="bg-[#030014]">'+htmlContent+'</body></html>'; var blob = new Blob([fullHtml], { type: 'text/html;charset=utf-8' }); saveAs(blob, sectionId+'-section.html'); } else if(format==='png'){ html2canvas(element, { backgroundColor:null, useCORS:true }).then(function(canvas){ canvas.toBlob(function(blob){ saveAs(blob, sectionId+'-section.png'); }); }); } }

function exportPage(){ var frame = $('#preview-frame'); var finalHtml = frame ? frame.srcdoc : ''; var passwords = pageData.security.passwords || []; if(passwords.length>0){ var modalHtml = '' + '<div id="password-modal" class="fixed inset-0 bg-black bg-opacity-80 items-center justify-center z-50 p-4" style="display:flex;">' + '  <div class="bg-[#110d24] border border-white/10 rounded-2xl p-8 max-w-sm w-full text-center shadow-2xl">' + '    <h2 class="text-2xl font-bold text-white">Access Required</h2>' + '    <p class="mt-2 text-gray-400">Please enter the password to view this update.</p>' + '    <input type="password" id="password-input" class="mt-6 w-full bg-gray-900/50 border border-white/20 rounded-lg p-3 text-white text-center focus:ring-2 focus:ring-[#9378ff] focus:outline-none" placeholder="••••••••" autocomplete="current-password"/>' + '    <p id="password-error" class="text-red-400 text-sm mt-2 h-5"></p>' + '    <button id="unlock-button" class="mt-4 w-full bg-[#9378ff] hover:bg-[#8162ff] text-white font-bold py-3 px-4 rounded-lg transition-all duration-200">Unlock</button>' + '  </div>' + '</div>'; finalHtml = finalHtml.replace(/<body([^>]*)>/i, function(m, attrs){ return '<body'+attrs+'>'+modalHtml; }); var passScript = '' + '<script type="text/javascript">' + '(function(){' + 'var PASSWORDS='+JSON.stringify(passwords)+';' + 'function unlock(){' + '  var input=document.getElementById("password-input");' + '  var err=document.getElementById("password-error");' + '  var modal=document.getElementById("password-modal");' + '  var pw=(input&&input.value?input.value:"").trim();' + '  if(PASSWORDS.indexOf(pw)!==-1){ modal.style.display="none"; document.body.style.overflow="auto"; }' + '  else{ err.textContent="Invalid password. Please try again."; if(input) input.value=""; }' + '}' + 'document.addEventListener("DOMContentLoaded",function(){' + '  var btn=document.getElementById("unlock-button");' + '  var input=document.getElementById("password-input");' + '  if(btn&&input){ btn.addEventListener("click",unlock); input.addEventListener("keypress",function(e){ if(e.key==="Enter") unlock(); }); document.body.style.overflow="hidden"; }' + '});' + '})();' + '<' + '/script>'; finalHtml = finalHtml.replace(/<\/body\s*>/i, passScript + '</body>'); }
 var blob = new Blob([finalHtml], { type: 'text/html;charset=utf-8' }); saveAs(blob, 'index.html'); }

// ===================================================================================
// DRAG & DROP INIT
// ===================================================================================
function initSortable(){ var sectionContainer = document.getElementById('section-list-container'); if(sectionContainer){ var s = new Sortable(sectionContainer,{ animation:150, handle:'.drag-handle', ghostClass:'sortable-ghost', onEnd:function(evt){ var contentSections = orderedSections.filter(function(s){ return s!=='security' && s!=='globalStyles'; }); var moved = contentSections.splice(evt.oldIndex,1)[0]; contentSections.splice(evt.newIndex,0,moved); var newOrder = ['security','globalStyles'].concat(contentSections); orderedSections.length = 0; Array.prototype.push.apply(orderedSections,newOrder); updatePreview(); } }); sortableInstances.push(s); }
 document.querySelectorAll('.item-list-container').forEach(function(container){ var section = container.dataset.section; var arrayKey = container.dataset.arrayKey; var s = new Sortable(container,{ animation:150, handle:'.drag-handle', ghostClass:'sortable-ghost', onEnd:function(evt){ var items = pageData[section][arrayKey]; var movedItem = items.splice(evt.oldIndex,1)[0]; items.splice(evt.newIndex,0,movedItem); renderEditorUI(); updatePreview(); } }); sortableInstances.push(s); }); }

// ===================================================================================
// EDITOR PASSWORD GATE (for this editor file)
// ===================================================================================
function checkEditorPassword(){ var passwords = pageData.security.passwords; if(!passwords || passwords.length===0) return; var modal = $('#editor-password-modal'); var input = $('#editor-password-input'); var error = $('#editor-password-error'); var button = $('#editor-unlock-button'); modal.style.display='flex'; input.focus(); function unlock(){ var pw = (input.value||'').trim(); if(passwords.indexOf(pw)!==-1){ modal.style.display='none'; } else { error.textContent='Invalid password.'; input.value=''; } } button.addEventListener('click', unlock); input.addEventListener('keypress', function(e){ if(e.key==='Enter') unlock(); }); }

// ===================================================================================
// INIT
// ===================================================================================
document.addEventListener('DOMContentLoaded', function(){ renderEditorUI(); updatePreview(); checkEditorPassword(); editorControls.addEventListener('input', handleInputChange); editorControls.addEventListener('change', handleInputChange); editorControls.addEventListener('click', function(e){ handleAddItem(e); handleDeleteItem(e); handleAccordionToggle(e); handleItemVisibilityToggle(e); if(e.target.closest('.export-section-png-btn')) exportSection(e,'png'); if(e.target.closest('.export-section-html-btn')) exportSection(e,'html'); }); document.getElementById('export-page-btn').addEventListener('click', exportPage); });
</script>
</body>
</html>
