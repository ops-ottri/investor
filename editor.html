<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Ottri Page Editor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Fonts and Tailwind -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Lato:wght@800;900&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- SortableJS and html2canvas -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

  <style>
    body { background: #030014; font-family: 'Inter', sans-serif; color: white; }
    .accordion-content { display: none; }
    .accordion-header.expanded + .accordion-content { display: block; }
    .sortable-ghost { opacity: 0.4; }
  </style>
</head>
<body>
  <div id="editor-password-modal" class="fixed inset-0 bg-black bg-opacity-80 items-center justify-center z-50 hidden p-4">
    <div class="bg-[#110d24] border border-white/10 rounded-2xl p-8 max-w-sm w-full text-center shadow-2xl">
      <h2 class="text-2xl font-bold text-white">Access Required</h2>
      <p class="mt-2 text-gray-400">Enter the password to edit this page.</p>
      <input type="password" id="editor-password-input" class="mt-6 w-full bg-gray-900/50 border border-white/20 rounded-lg p-3 text-white text-center focus:ring-2 focus:ring-[#9378ff] focus:outline-none" placeholder="••••••••" autocomplete="current-password" />
      <p id="editor-password-error" class="text-red-400 text-sm mt-2 h-5"></p>
      <button id="editor-unlock-button" class="mt-4 w-full bg-[#9378ff] hover:bg-[#8162ff] text-white font-bold py-3 px-4 rounded-lg transition-all duration-200">Unlock</button>
    </div>
  </div>

  <div class="flex h-screen">
    <!-- Left Panel -->
    <div class="w-1/3 bg-[#1a1628] overflow-y-auto p-6 border-r border-white/10" id="editor-controls"></div>

    <!-- Right Preview -->
    <div class="w-2/3 flex flex-col">
      <iframe id="preview-frame" class="flex-1 w-full border-0"></iframe>
      <div class="p-4 border-t border-white/10 bg-[#1a1628] text-right">
        <button id="export-page-btn" class="bg-[#9378ff] hover:bg-[#8162ff] text-white font-bold py-2 px-4 rounded-lg transition-all">Export Page</button>
      </div>
    </div>
  </div>

  <!-- ============ START SCRIPT SECTION ============ -->
  <script>
  // simplified example data for preview; replace with your full JSON later
  var pageData = {
    security: { title: "Security", passwords: ["demo"] },
    globalStyles: {
      backgroundColor: "#030014",
      gradient1Color: "#6d28d9",
      gradient2Color: "#9333ea",
      gradient1Position: "0%",
      gradient2Position: "100%",
      baseTextColor: "#ffffff",
      eyebrowColor: "#a78bfa",
      primaryFont: "Inter",
      titleFont: "Lato"
    },
    hero: { id: "hero", enabled: true, title: "Hero", eyebrowText: "Welcome", titleText: "Ottri Investor Update", bodyText: "Sample section" }
  };
  var orderedSections = ["security", "globalStyles", "hero"];

  function updatePreview() {
    var html = '<style>body{background:' + pageData.globalStyles.backgroundColor + ';color:white;font-family:' + pageData.globalStyles.primaryFont + ';}</style>';
    orderedSections.forEach(function(k){ if(pageData[k] && pageData[k].enabled!==false){ html += '<section id="section-'+k+'" class="p-12">'+(pageData[k].titleText||pageData[k].title||k)+'</section>'; }});
    document.querySelector('#preview-frame').srcdoc = html;
  }
  </script>

  <!-- ============ INSERT FIXED PART 3 (LOGIC + EXPORT) ============ -->
  <script>
  // (Part 3 begins here)
  // ... trimmed setup for brevity, use the final fixed Part 3 from above including exportPage() fix ...
  </script>
</body>
</html>
