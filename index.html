<!DOCTYPE html>
<html>
<head>
  <title>Ottri Investor Update</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- GViz perf hints -->
  <link rel="dns-prefetch" href="https://docs.google.com">
  <link rel="preconnect" href="https://docs.google.com" crossorigin>

  <!-- Inter (UI) + Lato (titles) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Lato:wght@800;900&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Preload your stencil font (same folder as index.html) -->
  <link rel="preload" as="font" href="L-7%20Stencil.ttf" type="font/ttf" crossorigin>

  <style>
    /* ===== Custom stencil font ===== */
    @font-face{
      font-family:"L7Stencil";
      src:url("L-7%20Stencil.ttf") format("truetype");
      font-display:swap;
      font-weight:400;
      font-style:normal;
    }
    /* Optional: bold file auto-usage if you ever add it */
    @font-face{
      font-family:"L7StencilBold";
      src:url("L-7%20Stencil%20Bold.ttf") format("truetype");
      font-display:swap;
      font-weight:700;
      font-style:normal;
    }

    /* ===== Base ===== */
    body{font-family:'Inter',sans-serif;background-color:#030014;color:#fff}
    .section-eyebrow{color:#9378ff;font-weight:600;letter-spacing:.1em;text-transform:uppercase}
    body::before{content:'';position:fixed;inset:0;background:
      radial-gradient(circle at top,rgba(76,36,159,.3) 0%,rgba(76,36,159,0) 40%);
      z-index:-1;pointer-events:none}
    .loader{border:4px solid rgba(255,255,255,.2);border-top:4px solid #9378ff;border-radius:50%;
      width:40px;height:40px;animation:spin 1s linear infinite}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    .title-gradient{background:linear-gradient(90deg,#F97316,#D946EF,#8B5CF6);
      -webkit-background-clip:text;background-clip:text;color:transparent}
    .section-separator{position:relative}
    .section-separator::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);
      width:90%;max-width:1280px;border-top:1px solid rgba(255,255,255,.1)}
    @keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.7;transform:scale(1.1)}}

    /* ===== Mobile accordion ===== */
    @media (max-width:768px){
      .section-header-mobile{cursor:pointer}
      .section-content{max-height:0;overflow:hidden;transition:max-height .45s ease}
      .section-content.expanded{max-height:5000px}
      .chevron-indicator{transition:transform .3s ease;animation:pulse 2.5s infinite cubic-bezier(.4,0,.6,1)}
      .section-header-mobile.expanded .chevron-indicator{transform:rotate(180deg);animation:none}
    }

    /* ===== Titles — Lato body + stencil first letter (wrapped span.initial) ===== */
    .hero-title,
    .section-title{
      font-family:'Lato',sans-serif;
      font-weight:800; /* ExtraBold/Black look */
      -webkit-font-smoothing:antialiased;
      text-rendering:optimizeLegibility;
    }

    /* Edge-only emboldening keeps stencil cutouts crisp */
    .initial{
      font-family:"L7StencilBold","L7Stencil",'Lato',sans-serif;
      font-weight:700;
      filter:
        drop-shadow( 0.35px  0      0 currentColor)
        drop-shadow(-0.35px  0      0 currentColor)
        drop-shadow( 0       0.35px 0 currentColor)
        drop-shadow( 0      -0.35px 0 currentColor)
        drop-shadow( 0.25px  0.25px 0 currentColor)
        drop-shadow(-0.25px  0.25px 0 currentColor)
        drop-shadow( 0.25px -0.25px 0 currentColor)
        drop-shadow(-0.25px -0.25px 0 currentColor);
    }

    /* Print deterrent */
    @media print{body{display:none!important}}
  </style>
</head>
<body class="antialiased" style="overflow:hidden;">

  <!-- Password Modal -->
  <div id="password-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4">
    <div class="bg-[#110d24] border border-white/10 rounded-2xl p-8 max-w-sm w-full text-center shadow-2xl">
      <h2 class="text-2xl font-bold text-white">Access Required</h2>
      <p class="mt-2 text-gray-400">Please enter the password to view this update.</p>
      <input type="password" id="password-input" class="mt-6 w-full bg-gray-900/50 border border-white/20 rounded-lg p-3 text-white text-center focus:ring-2 focus:ring-[#9378ff] focus:outline-none" placeholder="••••••••" autocomplete="current-password">
      <p id="password-error" class="text-red-400 text-sm mt-2 h-5"></p>
      <button id="unlock-button" class="mt-4 w-full bg-[#9378ff] hover:bg-[#8162ff] text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 flex items-center justify-center">
        <span id="unlock-text">Unlock</span>
        <div id="unlock-spinner" class="loader w-6 h-6 border-2 hidden" aria-hidden="true"></div>
      </button>
    </div>
  </div>
  
  <header id="header-container" class="hidden"></header>
  <main id="content-container" class="hidden"></main>
  <footer id="footer-container" class="hidden"></footer>

<script>
/* =======================
   CONFIG
   ======================= */
const SHEET_ID = "1sJQIQuUWe0sOrytSmJj0siTsuAR5ZNL2MEpcZsyBYUc";
const TAB_ORDER = ["title","intro","team","momentum","product","roadmap","market","partners","vision","footer"];
const TITLE_TABS  = ["title","hero","header"];
const FOOTER_TABS = ["footer","foot","end"];
/* SHA-256('iloveottri') */
const PASSWORD_SHA256 = "903c8a8eb1cc4a21747ceb0d3ddb3419d6b94dd8d37cf64ffb37ce00f69cfff8";

/* =======================
   Small helpers
   ======================= */
const GRADIENT_RE=/\*(.*?)\*/g;
const $ = sel => document.querySelector(sel);

function applyGradient(text){
  return (!text||typeof text!=='string') ? '' :
    text.replace(GRADIENT_RE,'<span class="title-gradient">$1</span>');
}

/* Wrap first visible character of a title in <span class="initial"> */
function wrapInitial(el){
  if(!el) return;
  const walker=document.createTreeWalker(el,NodeFilter.SHOW_TEXT,{acceptNode:n=>{
    return n.nodeValue && n.nodeValue.replace(/\s+/g,'').length ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP;
  }});
  const firstText=walker.nextNode();
  if(!firstText) return;
  const s=firstText.nodeValue;
  const i=s.search(/\S/);
  if(i===-1) return;
  const before=s.slice(0,i);
  const first =s[i];
  const after =s.slice(i+1);
  const span=document.createElement('span');
  span.className='initial';
  span.textContent=first;
  const frag=document.createDocumentFragment();
  frag.appendChild(document.createTextNode(before));
  frag.appendChild(span);
  frag.appendChild(document.createTextNode(after));
  firstText.parentNode.replaceChild(frag,firstText);
}

/* Apply to hero & every section title after they render */
function applyInitials(){
  document.querySelectorAll('.hero-title, .section-title').forEach(wrapInitial);
}

/* =======================
   GViz fetch
   ======================= */
function gvizUrl(name){
  return `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(name)}&tq=${encodeURIComponent("select *")}`;
}
function parseGViz(txt){
  const s=txt.indexOf('{'), e=txt.lastIndexOf('}');
  if(s===-1||e===-1) throw new Error("Bad GViz response");
  const json=JSON.parse(txt.slice(s,e+1));
  return (json.table?.rows||[]).map(r=>(r.c||[]).map(c=>c&&c.v!=null?c.v:null));
}
async function fetchTab(n){
  const res=await fetch(gvizUrl(n),{cache:'no-store'});
  if(!res.ok) throw new Error(`Fetch failed for tab "${n}" (${res.status})`);
  const txt=await res.text();
  return parseGViz(txt);
}
async function loadFromSheets(){
  const names=TAB_ORDER.map(n=>n.toLowerCase());
  const results={};
  await Promise.all(names.map(async n=>{
    try{ results[n]=await fetchTab(n); }catch(e){ console.warn('Tab load failed:',n,e); results[n]=[]; }
  }));
  const titleName = names.find(n=>TITLE_TABS.includes(n)) || names[0];
  const footerName= names.find(n=>FOOTER_TABS.includes(n)) || names[names.length-1];
  return {
    titleData:  {name:titleName,  data:results[titleName]  || []},
    footerData: {name:footerName, data:results[footerName] || []},
    contentData: names.filter(n=>n!==titleName && n!==footerName).map(n=>({name:n, data:results[n]||[]}))
  };
}

/* =======================
   Renderers
   ======================= */
function renderHeroSection(sheet){
  const d=sheet.data||[]; if(d.length<2) return '';
  const r=d[1]||[];
  const title=String(r[0]??'');
  const subtitle=String(r[1]??'');
  const logo=String(r[2]??'');
  let h = '<div class="text-center py-16 sm:py-20 px-6 lg:px-8">';
  if(logo)   h += `<img class="max-h-48 w-auto mx-auto mb-8" src="${logo}" alt="Ottri Logo" loading="lazy">`;
  if(title)  h += `<h1 class="hero-title text-4xl font-bold tracking-tight sm:text-6xl leading-snug sm:leading-snug">${applyGradient(title)}</h1>`;
  if(subtitle)h += `<p class="mt-4 text-lg leading-8 text-gray-300">${applyGradient(subtitle)}</p>`;
  h += '</div>';
  return h;
}

function renderStandardSection(sheet){
  const d=sheet.data||[]; if(d.length<2) return '';
  const hdr=d[1]||[];
  const eyebrow=String(hdr[0]??'');
  const title  =String(hdr[1]??'');
  const desc   =String(hdr[7]??'');
  const paras=[];
  // Row 2 onward (index 1+) in column C
  for(let i=1;i<d.length;i++){ if(d[i] && d[i][2]!=null && String(d[i][2]).trim()!=='') paras.push(String(d[i][2])); }

  let h = '<div class="max-w-4xl mx-auto text-center py-16 sm:py-24 px-6 lg:px-8">';
  h += '<div class="section-header-mobile">';
  if(eyebrow) h += `<p class="section-eyebrow mb-4">${applyGradient(eyebrow)}</p>`;
  if(title)   h += `<h2 class="section-title text-4xl md:text-5xl font-extrabold tracking-tight">${applyGradient(title)}</h2>`;
  if(desc)    h += `<p class="mt-4 max-w-3xl mx-auto text-lg text-gray-300">${applyGradient(desc)}</p>`;
  h += '<div class="md:hidden flex justify-center mt-6"><svg class="chevron-indicator w-6 h-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></div>';
  h += '</div><div class="section-content">';
  paras.forEach(p=> h += `<p class="mt-6 max-w-2xl mx-auto text-lg text-gray-300 text-center">${applyGradient(p).replace(/\n/g,'<br/>')}</p>`);
  h += '</div></div>';
  return h;
}

/* Hybrid stats renderer — supports:
   - Paragraph mode: uses C2 + C3..Cn as paragraphs
   - Card mode: uses rows 3..n as cards (A/B/C), row 2 remains header
*/
function renderStatsSection(sheet){
  const d=sheet.data||[]; if(d.length<2) return '';
  const hdr=d[1]||[];
  const eyebrow=String(hdr[0]??'');
  const title  =String(hdr[1]??'');
  const desc   =String(hdr[7]??'');

  const row2C = String((d[1]?.[2]) ?? '').trim(); // allow a paragraph on row 2
  const rowsAfterHeader = d.slice(2).filter(r=>r && r.some(c=>String(c??'').trim()!==''));

  const restAllC = rowsAfterHeader.length>0 && rowsAfterHeader.every(r=>{
    const a = String(r[0]??'').trim();
    const b = String(r[1]??'').trim();
    const c = String(r[2]??'').trim();
    return !a && !b && !!c;
  });

  if(restAllC || (row2C && rowsAfterHeader.length===0)){
    // Paragraph mode: row2C (if any) + C from all following rows
    const paragraphs = [];
    if(row2C) paragraphs.push(row2C);
    rowsAfterHeader.forEach(r=>{
      const c = String(r[2]??'').trim();
      if(c) paragraphs.push(c);
    });

    let h = '<div class="max-w-4xl mx-auto text-center py-16 sm:py-24 px-6 lg:px-8">';
    h += '<div class="section-header-mobile">';
    if(eyebrow) h += `<p class="section-eyebrow mb-4">${applyGradient(eyebrow)}</p>`;
    if(title)   h += `<h2 class="section-title text-4xl md:text-5xl font-extrabold tracking-tight">${applyGradient(title)}</h2>`;
    if(desc)    h += `<p class="mt-4 max-w-3xl mx-auto text-lg text-gray-300">${applyGradient(desc)}</p>`;
    h += '<div class="md:hidden flex justify-center mt-6"><svg class="chevron-indicator w-6 h-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></div>';
    h += '</div><div class="section-content">';
    paragraphs.forEach(p=>{
      h += `<p class="mt-6 max-w-2xl mx-auto text-lg text-gray-300 text-center">${applyGradient(p).replace(/\n/g,'<br/>')}</p>`;
    });
    h += '</div></div>';
    return h;
  }

  // Card mode: only use rows AFTER header (row 3+)
  const stats = rowsAfterHeader.map(r=>({
    value:String(r[0]??'').trim(),
    title:String(r[1]??'').trim(),
    body :String(r[2]??'').trim()
  })).filter(s=>s.value || s.title || s.body);

  let h = '<div class="max-w-5xl mx-auto text-center py-16 sm:py-24 px-6 lg:px-8">';
  h += '<div class="section-header-mobile">';
  if(eyebrow) h += `<p class="section-eyebrow mb-4">${applyGradient(eyebrow)}</p>`;
  if(title)   h += `<h2 class="section-title text-4xl md:text-5xl font-extrabold tracking-tight">${applyGradient(title)}</h2>`;
  if(desc)    h += `<p class="mt-4 max-w-3xl mx-auto text-lg text-gray-300">${applyGradient(desc)}</p>`;
  h += '<div class="md:hidden flex justify-center mt-6"><svg class="chevron-indicator w-6 h-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></div>';
  h += '</div><div class="section-content">';

  if(stats.length){
    let grid = '<div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-8">';
    stats.forEach(s=>{
      grid +=
        '<div class="bg-gray-800/30 backdrop-blur-sm rounded-xl p-8 border border-white/10 text-center">'+
          (s.value ? `<p class="text-4xl md:text-5xl font-extrabold text-[#9378ff]">${applyGradient(s.value)}</p>` : '')+
          (s.title ? `<h3 class="mt-2 text-lg font-semibold text-white">${applyGradient(s.title)}</h3>` : '')+
          (s.body  ? `<p class="mt-1 text-gray-400">${applyGradient(s.body).replace(/\n/g,'<br/>')}</p>` : '')+
        '</div>';
    });
    grid += '</div>';
    h += grid;
  }

  h += '</div></div>';
  return h;
}

function renderTeamSection(sheet){
  const d=sheet.data||[]; if(d.length<2) return '';
  const hdr=d[1]||[];
  const eyebrow=String(hdr[0]??'');
  const title  =String(hdr[1]??'');
  const desc   =String(hdr[7]??'');

  const members = [];

  // Allow a member on row 2 if member columns (C..F) are used
  const r2 = d[1] || [];
  if([2,3,4,5].some(ix => String(r2[ix]??'').trim() !== '')){
    members.push(r2);
  }
  // And any rows after header
  for(let i=2;i<d.length;i++){
    const row = d[i];
    if(!row) continue;
    const hasData = row.some(c=>String(c??'').trim()!=='');
    if(hasData) members.push(row);
  }

  let h = '<div class="max-w-6xl mx-auto text-center py-16 sm:py-24 px-6 lg:px-8">';
  h += '<div class="section-header-mobile">';
  if(eyebrow) h += `<p class="section-eyebrow mb-4">${applyGradient(eyebrow)}</p>`;
  if(title)   h += `<h2 class="section-title text-4xl md:text-5xl font-extrabold tracking-tight">${applyGradient(title)}</h2>`;
  if(desc)    h += `<p class="mt-4 max-w-3xl mx-auto text-lg text-gray-300">${applyGradient(desc)}</p>`;
  h += '<div class="md:hidden flex justify-center mt-6"><svg class="chevron-indicator w-6 h-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></div>';
  h += '</div><div class="section-content">';

  if(members.length){
    let grid='<div class="mt-12 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">';
    members.forEach(m=>{
      const name=String(m[2]??'');
      const job =String(m[4]??'');
      const bio =String(m[5]??'');
      const img =String(m[3]??'');
      const initials=(name.split(' ').map(n=>n[0]).join('')||'??').toUpperCase();
      const ph=`https://placehold.co/256x256/4B5563/FFFFFF?text=${encodeURIComponent(initials)}`;
      const src=img||ph;
      grid +=
        '<div class="text-center bg-gray-800/30 backdrop-blur-sm rounded-xl p-8 border border-white/10">'+
          `<img class="w-32 h-32 rounded-full mx-auto object-cover mb-4 border-4 border-white/10" src="${src}" alt="${name}" loading="lazy" onerror="this.onerror=null;this.src='${ph}'">`+
          `<h3 class="text-xl font-bold tracking-tight text-white">${applyGradient(name)}</h3>`+
          (job?`<p class="text-indigo-300">${applyGradient(job)}</p>`:'')+
          (bio?`<p class="mt-2 text-gray-400 text-sm">${applyGradient(bio)}</p>`:'')+
        '</div>';
    });
    grid+='</div>';
    h+=grid;
  }
  h+='</div></div>';
  return h;
}

function renderFooterSection(sheet){
  const d=sheet.data||[]; if(d.length<2) return '';
  const r=d[1]||[];
  const eyebrow=String(r[0]??'');
  let body='';
  [1,2,3].forEach(i=>{
    const v=String(r[i]??'');
    if(v) body += `<p class="mt-4 text-md text-gray-400">${applyGradient(v).replace(/\n/g,'<br/>')}</p>`;
  });
  let h = '<div class="section-separator py-16 sm:py-24 px-6 lg:px-8"><div class="max-w-4xl mx-auto text-center">';
  if(eyebrow) h += `<p class="section-eyebrow mb-4">${applyGradient(eyebrow)}</p>`;
  h += body + '</div></div>';
  return h;
}

/* ============== Page assembly ============== */
function renderPage(res){
  const main=$("#content-container");
  const head=$("#header-container");
  const foot=$("#footer-container");

  if(res.titleData) head.innerHTML = renderHeroSection(res.titleData);

  main.innerHTML='';
  if(res.contentData?.length){
    res.contentData.forEach(sheet=>{
      const name=(sheet.name||'').toLowerCase();
      let html='';
      if(name.includes('team')||name.includes('partner')) html = renderTeamSection(sheet);
      else if(name.includes('traction')||name.includes('stat')||name.includes('momentum')) html = renderStatsSection(sheet);
      else html = renderStandardSection(sheet);
      const wrapper=document.createElement('div');
      wrapper.className='section-wrapper section-separator';
      wrapper.innerHTML=html;
      main.appendChild(wrapper);
    });
  }
  if(res.footerData) foot.innerHTML = renderFooterSection(res.footerData);

  head.classList.remove('hidden');
  main.classList.remove('hidden');
  foot.classList.remove('hidden');

  // After DOM is in place, wrap initials
  applyInitials();
  setupAccordion();
}

/* =======================
   Password
   ======================= */
async function sha256Hex(s){
  const enc=new TextEncoder().encode(s);
  const buf=await crypto.subtle.digest('SHA-256',enc);
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
}
async function doUnlock(){
  const input=$("#password-input");
  const err=$("#password-error");
  const btn=$("#unlock-button");
  const txt=$("#unlock-text");
  const spin=$("#unlock-spinner");

  const pw=(input.value||'').trim();
  if(!pw){err.textContent='Please enter a password.';return;}

  err.textContent=''; txt.classList.add('hidden'); spin.classList.remove('hidden'); btn.disabled=true;

  try{
    const hash=await sha256Hex(pw);
    if(hash!==PASSWORD_SHA256){ err.textContent='Invalid password. Please try again.'; return; }

    // Success
    $("#password-modal").style.display='none';
    document.body.style.overflow='auto';

    const data=await loadFromSheets();
    renderPage(data);
  }catch(e){
    err.textContent='Error unlocking. Please try again.';
  }finally{
    txt.classList.remove('hidden'); spin.classList.add('hidden'); btn.disabled=false;
  }
}
document.addEventListener('DOMContentLoaded', ()=>{
  $("#unlock-button").addEventListener('click', doUnlock);
  $("#password-input").addEventListener('keypress', e=>{ if(e.key==='Enter') doUnlock(); });
});
</script>
</body>
</html>
