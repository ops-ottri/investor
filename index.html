<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Ottri Investor Update</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- NEW: Cache-Busting Meta Tags --><!-- These tags instruct the browser to always fetch a fresh copy of this HTML file --><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <!-- Preconnect hints for performance --><link rel="dns-prefetch" href="https://docs.google.com" />
  <link rel="preconnect" href="https://docs.google.com" crossorigin />
  <link rel="dns-prefetch" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />

  <!-- Fonts: Inter (UI) + Lato (titles) --><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Lato:wght@800;900&display=swap" rel="stylesheet" />

  <!-- Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>

  <!-- Preload remote stencil font for faster rendering --><!-- REMOVED: Deleted the preload link for the stencil font. --><style>
   /* =================================== */
   /* ===== 1. BASE & TYPOGRAPHY      ===== */
   /* =================================== */
   /* REMOVED: Deleted the @font-face rule for the stencil font. */

   html {
     min-height: 100%;
     color-scheme: dark;
     background:
       radial-gradient(1200px 600px at 15% -10%, rgba(76,36,159,0.35) 0%, rgba(76,36,159,0) 45%),
       radial-gradient(1000px 500px at 85% 0%, rgba(217,70,239,0.20) 0%, rgba(217,70,239,0) 50%),
       #030014;
     background-repeat: no-repeat;
     background-attachment: fixed;
   }

   html, body {
     height: 100%;
   }

   body {
     font-family: "Inter", sans-serif;
     color: #ffffff;
     background: transparent;
     -webkit-font-smoothing: antialiased;
     text-rendering: optimizeLegibility;
   }

   .hero-title, .section-title {
     font-family: "Lato", sans-serif;
     font-weight: 800;
   }

   .initial {
     /* UPDATED: Removed the reference to the deleted "L7Stencil" font. */
     font-family: "Lato", sans-serif;
     font-weight: 700;
     filter:
       drop-shadow( 0.35px  0       0 currentColor)
       drop-shadow(-0.35px  0       0 currentColor)
       drop-shadow( 0       0.35px  0 currentColor)
       drop-shadow( 0       -0.35px  0 currentColor)
       drop-shadow( 0.25px  0.25px  0 currentColor)
       drop-shadow(-0.25px  0.25px  0 currentColor)
       drop-shadow( 0.25px -0.25px  0 currentColor)
       drop-shadow(-0.25px -0.25px  0 currentColor);
   }
   
   .whitespace-pre-line { white-space: pre-line; }

   /* =================================== */
   /* ===== 2. LAYOUT & UTILITIES   ===== */
   /* =================================== */
   .section-separator { position: relative; }
   .section-separator::before {
     content: ""; position: absolute; top: 0; left: 50%; transform: translateX(-50%);
     width: 90%; max-width: 1280px; border-top: 1px solid rgba(255, 255, 255, 0.1);
   }
   .section-eyebrow { color: #9378ff; font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase; }
   .title-gradient { background: linear-gradient(90deg, #F97316, #D946EF, #8B5CF6); -webkit-background-clip: text; background-clip: text; color: transparent; }
   .loader { border: 4px solid rgba(255, 255, 255, 0.2); border-top-color: #9378ff; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
   .scroll-container { -ms-overflow-style: none; scrollbar-width: none; }
   .scroll-container::-webkit-scrollbar { display: none; }

   /* =================================== */
   /* ===== 3. COMPONENTS           ===== */
   /* =================================== */
   
   /* --- KPI Widget --- */
   .kpi-widget {
     --hover-gradient: linear-gradient(120deg, #8B5CF6, #A78BFA); background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
     backdrop-filter: blur(12px); border-radius: 1rem; padding: 1.5rem; border: 1px solid rgba(255,255,255,0.1); position: relative; overflow: hidden;
     transition: transform .3s ease, box-shadow .3s ease; transform: translateY(0); opacity: 0; animation: fadeInUp .6s ease-out forwards;
   }
   .kpi-widget:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
   .kpi-widget::before {
     content: ""; position: absolute; inset: 0; border-radius: 1rem; padding: 2px; background: var(--hover-gradient);
     -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); -webkit-mask-composite: destination-out; mask-composite: exclude;
     opacity: 0; transition: opacity .4s ease-in-out;
   }
   .kpi-widget:hover::before { opacity: 1; }
   .kpi-widget:nth-child(1) { animation-delay: .1s; } .kpi-widget:nth-child(2) { animation-delay: .2s; } .kpi-widget:nth-child(3) { animation-delay: .3s; }
   .kpi-widget:nth-child(4) { animation-delay: .4s; } .kpi-widget:nth-child(5) { animation-delay: .5s; } .kpi-widget:nth-child(6) { animation-delay: .6s; }
   .kpi-icon { width: 2rem; height: 2rem; display:flex; align-items:center; justify-content:center; border-radius:.5rem; background: rgba(139,92,246,0.10); box-shadow: 0 0 0 1px rgba(255,255,255,0.08) inset; }
   .kpi-icon img, .kpi-icon svg { width: 1.1rem; height: 1.1rem; opacity: .9; filter: drop-shadow(0 0 6px rgba(147,120,255,.35)); }
   .kpi-widget--takeover { --hover-gradient: linear-gradient(120deg, #8B5CF6, #D946EF); background: linear-gradient(120deg, #8B5CF6, #D946EF, #030014, #030014); background-size: 300% 300%; animation: fadeInUp .6s ease-out forwards, animated-gradient 12s ease infinite; animation-delay: .1s, 0s; }
   .kpi-widget--featured { background: linear-gradient(145deg, rgba(139, 92, 246, 0.1), rgba(139, 92, 246, 0.03)); }
   .kpi-widget--featured:hover { transform: translateY(-8px) scale(1.02); }
   .kpi-widget--highlight { --hover-gradient: linear-gradient(120deg, #F97316, #F59E0B, #D97706); }
   .kpi-widget--highlight .kpi-icon { background: rgba(249, 115, 22, 0.15); } .kpi-widget--highlight .kpi-icon svg, .kpi-widget--highlight .kpi-icon img { filter: drop-shadow(0 0 6px rgba(249, 115, 22, 0.45)); }
   .kpi-widget--highlight h3 { color: #FDBA74; } .kpi-widget--highlight p:not(.text-4xl) { color: #FCD34D; }
   .kpi-widget--custom { --widget-accent-color: #8B5CF6; --hover-gradient: linear-gradient(120deg, var(--widget-accent-color), color-mix(in srgb, var(--widget-accent-color) 70%, white)); background: linear-gradient(145deg, color-mix(in srgb, var(--widget-accent-color) 12%, #030014), color-mix(in srgb, var(--widget-accent-color) 5%, #030014)); }
   .kpi-widget--custom h3 { color: color-mix(in srgb, var(--widget-accent-color) 70%, #FFFFFF); } .kpi-widget--custom p:not(.text-4xl) { color: color-mix(in srgb, var(--widget-accent-color) 50%, #FFFFFF); }
   .kpi-widget--custom .kpi-icon { background-color: color-mix(in srgb, var(--widget-accent-color) 20%, transparent); } .kpi-widget--custom .kpi-icon svg, .kpi-widget--custom .kpi-icon img { filter: drop-shadow(0 0 6px var(--widget-accent-color)); }

   /* --- iPhone Mockup --- */
   .iphone-mockup { position: relative; width: 280px; height: 573px; margin: 0 auto; background-color: #1a1a1a; border-radius: 44px; border: 1px solid #444; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), inset 0 0 10px rgba(0,0,0,0.6); padding: 14px; transition: transform 0.3s ease, box-shadow 0.3s ease; transform-origin: center 30px; will-change: transform; }
   .iphone-mockup:hover { transform: translateY(-10px) scale(1.02); box-shadow: 0 35px 60px -15px rgba(147, 120, 255, 0.3); }
   .iphone-screen { background-color: #000; width: 100%; height: 100%; border-radius: 30px; overflow: hidden; position: relative; }
   .iphone-screen img, .iphone-screen iframe { width: 100%; height: 100%; object-fit: cover; border: none; display: block; }
   .iphone-notch { position: absolute; top: 14px; left: 50%; transform: translateX(-50%); width: 140px; height: 24px; background-color: #1a1a1a; border-radius: 0 0 16px 16px; z-index: 2; pointer-events: none; }
   
   /* --- 3D Cover Flow Roadmap --- */
   .coverflow-scene { height: 450px; position: relative; display: flex; align-items: center; justify-content: center; perspective: 1200px; }
   .coverflow-container { width: 320px; height: 400px; position: relative; transform-style: preserve-3d; }
   .coverflow-card {
     position: absolute; left: 0; top: 0; width: 100%; height: 100%; border-radius: 1rem;
     background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
     backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.15); box-shadow: 0 10px 30px rgba(0,0,0,0.2);
     backface-visibility: hidden; will-change: transform, opacity;
     transition: transform 0.5s cubic-bezier(0.645, 0.045, 0.355, 1), opacity 0.5s ease;
   }
   .coverflow-nav { display: flex; justify-content: center; gap: 1rem; margin-top: 1.5rem; }
   .nav-button {
     width: 44px; height: 44px; border-radius: 50%; background-color: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2);
     backdrop-filter: blur(10px); cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center;
   }
   .nav-button:hover:not(:disabled) { background-color: rgba(147, 120, 255, 0.5); transform: scale(1.1); }
   .nav-button:active:not(:disabled) { transform: scale(0.95); }
   .nav-button:disabled { opacity: 0.3; cursor: not-allowed; }

   /* =================================== */
   /* ===== 4. ANIMATIONS & MEDIA   ===== */
   /* =================================== */
   @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
   @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: .7; transform: scale(1.1); } }
   @keyframes fadeInUp { from { opacity: 0; transform: translateY(25px); } to { opacity: 1; transform: translateY(0); } }
   @keyframes animated-gradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

   @media (max-width: 768px) {
     .section-header-mobile { cursor: pointer; }
     .section-content { max-height: 0; overflow: hidden; transition: max-height .45s ease; }
     .section-content.expanded { max-height: 5000px; }
     .chevron-indicator { transition: transform .3s ease; animation: pulse 2.5s infinite cubic-bezier(.4, 0, .6, 1); }
     .section-header-mobile.expanded .chevron-indicator { transform: rotate(180deg); animation: none; }
   }
   @media print { body { display: none !important; } }
  </style>
</head>

<body style="overflow: hidden;">

  <div id="loading-indicator" class="fixed inset-0 bg-[#030014] flex items-center justify-center z-50">
    <div class="loader"></div>
  </div>

  <div id="password-modal" class="fixed inset-0 bg-black bg-opacity-80 hidden items-center justify-center z-50 p-4">
    <div class="bg-[#110d24] border border-white/10 rounded-2xl p-8 max-w-sm w-full text-center shadow-2xl">
      <h2 class="text-2xl font-bold text-white">Access Required</h2>
      <p class="mt-2 text-gray-400">Please enter the password to view this update.</p>
      <input type="password" id="password-input" class="mt-6 w-full bg-gray-900/50 border border-white/20 rounded-lg p-3 text-white text-center focus:ring-2 focus:ring-[#9378ff] focus:outline-none" placeholder="••••••••" autocomplete="current-password" />
      <p id="password-error" class="text-red-400 text-sm mt-2 h-5"></p>
      <button id="unlock-button" class="mt-4 w-full bg-[#9378ff] hover:bg-[#8162ff] text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
        <span id="unlock-text">Unlock</span>
        <div id="unlock-spinner" class="loader w-6 h-6 border-2 hidden" aria-hidden="true"></div>
      </button>
    </div>
  </div>

  <header id="header-container"></header>
  <main id="content-container"></main>
  <footer id="footer-container"></footer>

<script>
(function() {
  'use strict';

  const CONFIG = {
    SHEET_ID: "1sJQIQuUWe0sOrytSmJj0siTsuAR5ZNL2MEpcZsyBYUc",
    // NEW: Fallback order if `_config` sheet is not found.
    TAB_ORDER: ["title", "intro", "team", "momentum", "product", "market", "roadmap", "partners", "vision", "footer"],
    // NEW: Name of the sheet to control section order.
    CONFIG_TAB_NAME: "_config",
    TITLE_TAB_NAMES: ["title", "hero", "header"],
    FOOTER_TAB_NAMES: ["footer", "foot", "end"],
    PASSWORD_TAB_NAMES: ["passwords", "password", "pw"],
  };

  const $ = (selector) => document.querySelector(selector);
  const DOM = {
    body: document.body, loadingIndicator: $("#loading-indicator"), modal: $("#password-modal"),
    passwordInput: $("#password-input"), passwordError: $("#password-error"), unlockButton: $("#unlock-button"),
    unlockText: $("#unlock-text"), unlockSpinner: $("#unlock-spinner"), header: $("#header-container"),
    main: $("#content-container"), footer: $("#footer-container"),
  };

  const Utils = {
    applyGradient(text) { if (typeof text !== 'string') return ''; return text.replace(/\*(.*?)\*/g, '<span class="title-gradient">$1</span>'); },
    wrapInitial(element) {
        if (!element) return;
        const walker = document.createTreeWalker(element, NodeFilter.SHOW_TEXT, { acceptNode: (node) => (node.nodeValue.trim() ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT) });
        const firstTextNode = walker.nextNode(); if (!firstTextNode) return;
        const text = firstTextNode.nodeValue; const firstLetterIndex = text.search(/\S/); if (firstLetterIndex === -1) return;
        const before = text.slice(0, firstLetterIndex); const firstLetter = text[firstLetterIndex]; const after = text.slice(firstLetterIndex + 1);
        const span = document.createElement("span"); span.className = "initial"; span.textContent = firstLetter;
        const fragment = document.createDocumentFragment(); fragment.appendChild(document.createTextNode(before)); fragment.appendChild(span); fragment.appendChild(document.createTextNode(after));
        firstTextNode.parentNode.replaceChild(fragment, firstTextNode);
    },
    randomizeGradients() {
        const nodes = document.querySelectorAll(".title-gradient"); if (!nodes.length) return;
        const palette = ["#8B5CF6", "#D946EF", "#F97316", "#3B82F6", "#EC4899", "#22D3EE"];
        nodes.forEach(span => {
            const picks = [...palette].sort(() => 0.5 - Math.random()).slice(0, 3); const angle = Math.floor(Math.random() * 180);
            span.style.background = `linear-gradient(${angle}deg, ${picks.join(", ")})`;
            span.style.webkitBackgroundClip = "text"; span.style.backgroundClip = "text";
        });
    },
    escapeAttr(str) { return String(str || '').replace(/"/g, '&quot;'); }
  };

  const GSheetsAPI = {
    parseGVizResponse(text) {
      const start = text.indexOf("{"); const end = text.lastIndexOf("}");
      if (start === -1 || end === -1) { if (text.includes('"status":"ok"')) return []; throw new Error("Bad GViz response: No JSON object found."); }
      const json = JSON.parse(text.slice(start, end + 1));
      if (json.status === 'error') throw new Error(json.errors.map(e => e.detailed_message).join(', '));
      return (json.table.rows || []).map(row => (row.c || []).map(cell => cell?.v ?? null));
    },
    async fetchTab(tabName, query = "select *") {
      // NEW: Add a timestamp query parameter to bust the Google Sheets cache.
      const cacheBuster = `&_cb=${new Date().getTime()}`;
      const url = `https://docs.google.com/spreadsheets/d/${CONFIG.SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(tabName)}&tq=${encodeURIComponent(query)}${cacheBuster}`;
      try {
        const response = await fetch(url, { cache: "no-store" });
        if (!response.ok) throw new Error(`HTTP error ${response.status}`);
        const text = await response.text();
        return this.parseGVizResponse(text);
      } catch (error) {
        console.warn(`[App] Failed to fetch tab "${tabName}":`, error.message);
        throw error;
      }
    }
  };

  const Renderers = {
    createSectionHeader({ eyebrow, title, description }) {
      return `
        <div class="section-header-mobile">
          ${eyebrow ? `<p class="section-eyebrow mb-4">${Utils.applyGradient(eyebrow)}</p>` : ''}
          ${title ? `<h2 class="section-title text-4xl md:text-5xl font-extrabold tracking-tight">${Utils.applyGradient(title)}</h2>` : ''}
          ${description ? `<p class="mt-4 max-w-3xl mx-auto text-lg text-gray-300">${Utils.applyGradient(description)}</p>` : ''}
          <div class="md:hidden flex justify-center mt-6">
            <svg class="chevron-indicator w-6 h-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
          </div>
        </div>`;
    },
    renderIcon(src) { const s = String(src || "").trim(); if (!s) return ''; return s.startsWith('<svg') ? s : `<img src="${Utils.escapeAttr(s)}" alt="" loading="lazy" />`; },
    renderHero(sheet) {
      if (!sheet || !sheet.data) return '';
      const [title, subtitle, logo] = (sheet.data[1] || []);
      return `<div class="text-center py-16 sm:py-20 px-6 lg:px-8"> ${logo ? `<img class="max-h-24 w-auto mx-auto mb-8" src="${Utils.escapeAttr(logo)}" alt="Logo" loading="lazy" />` : ''} ${title ? `<h1 class="hero-title text-4xl font-bold tracking-tight sm:text-6xl leading-snug sm:leading-snug">${Utils.applyGradient(title)}</h1>` : ''} ${subtitle ? `<p class="mt-4 text-lg leading-8 text-gray-300">${Utils.applyGradient(subtitle)}</p>` : ''} </div>`;
    },
    renderStandard(sheet) {
        if (!sheet || !sheet.data) return '';
        const [eyebrow, title, , , , , , description] = (sheet.data[1] || []);
        const paragraphs = sheet.data.slice(1).map(row => row && row[2]).filter(p => p && String(p).trim() !== '').map(p => `<p class="mt-6 max-w-2xl mx-auto text-lg text-gray-300 text-center">${Utils.applyGradient(String(p)).replace(/\n/g, "<br/>")}</p>`).join('');
        return `<div class="max-w-4xl mx-auto text-center py-16 sm:py-24 px-6 lg:px-8"> ${this.createSectionHeader({ eyebrow, title, description })} <div class="section-content">${paragraphs}</div> </div>`;
    },
    renderTeam(sheet) {
        if (!sheet || !sheet.data) return '';
        const [eyebrow, title, , , , , , description] = (sheet.data[1] || []);
        const members = sheet.data.slice(1).map(row => ({ name: row[2], image: row[3], job: row[4], bio: row[5] })).filter(m => m.name || m.image || m.job || m.bio);
        const membersHtml = members.map(({ name, image, job, bio }) => {
            const initials = (String(name || '').split(" ").map(n => n[0]).join("") || "??").toUpperCase();
            const placeholder = `https://placehold.co/256x256/4B5563/FFFFFF?text=${encodeURIComponent(initials)}`;
            const src = image || placeholder;
            return `<div class="text-center bg-gray-800/30 backdrop-blur-sm rounded-xl p-8 border border-white/10 h-full flex flex-col"> <img class="w-32 h-32 rounded-full mx-auto object-cover mb-4 border-4 border-white/10" src="${Utils.escapeAttr(src)}" alt="${Utils.escapeAttr(name)}" loading="lazy" onerror="this.onerror=null;this.src='${placeholder}';" /> <h3 class="text-xl font-bold tracking-tight text-white">${Utils.applyGradient(name)}</h3> ${job ? `<p class="text-indigo-300 whitespace-pre-line">${Utils.applyGradient(job)}</p>` : ""} <div class="flex-1 mt-2"> ${bio ? `<p class="text-gray-400 text-sm">${Utils.applyGradient(bio)}</p>` : ""} </div> </div>`;
        }).join('');
        return `<div class="max-w-6xl mx-auto text-center py-16 sm:py-24 px-6 lg:px-8"> ${this.createSectionHeader({ eyebrow, title, description })} <div class="section-content"> <div class="mt-12 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">${membersHtml}</div> </div> </div>`;
    },
    renderStats(sheet) {
        if (!sheet || !sheet.data) return '';
        const [eyebrow, title, , , , , , description] = sheet.data[1] || [];
        const stats = sheet.data.slice(2).map(row => ({ value: row[0], title: row[1], body: row[2] })).filter(s => s.value || s.title || s.body);
        const statsHtml = stats.map(({ value, title, body }) => `<div class="bg-gray-800/30 backdrop-blur-sm rounded-xl p-8 border border-white/10 text-center h-full flex flex-col justify-center"> ${value ? `<p class="text-4xl md:text-5xl font-extrabold text-[#9378ff]">${Utils.applyGradient(value)}</p>` : ''} ${title ? `<h3 class="mt-2 text-lg font-semibold text-white">${Utils.applyGradient(title)}</h3>` : ''} ${body ? `<p class="mt-1 text-gray-400">${Utils.applyGradient(body).replace(/\n/g, "<br/>")}</p>` : ''} </div>`).join('');
        return `<div class="max-w-5xl mx-auto text-center py-16 sm:py-24 px-6 lg:px-8"> ${this.createSectionHeader({ eyebrow, title, description })} <div class="section-content"> ${stats.length ? `<div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-8">${statsHtml}</div>` : ''} </div> </div>`;
    },
    renderProduct(sheet) {
        if (!sheet || !sheet.data) return '';
        const [eyebrow, title, , , , , , description] = sheet.data[1] || [];
        const links = sheet.data.slice(2).map(r => r && String(r[8] || '').trim()).filter(Boolean);
        if (!links.length) return '';
        const mockupsHtml = links.map((link, index) => {
            const content = link.toLowerCase().endsWith('.pdf') ? `<iframe src="${Utils.escapeAttr(link)}" title="Platform Screen ${index + 1}"></iframe>` : `<img src="${Utils.escapeAttr(link)}" alt="Platform Screenshot ${index + 1}" onerror="this.onerror=null;this.src='https://placehold.co/375x812/030014/9378ff?text=Image+Failed';">`;
            return `<div class="iphone-mockup flex-shrink-0"> <div class="iphone-notch"></div> <div class="iphone-screen">${content}</div> </div>`;
        }).join('');
        return `<div class="max-w-7xl mx-auto text-center py-16 sm:py-24 px-6 lg:px-8"> ${this.createSectionHeader({ eyebrow, title, description })} <div class="section-content"> <div class="mt-20 flex flex-nowrap lg:flex-wrap justify-start lg:justify-center items-center gap-x-8 gap-y-12 overflow-x-auto scroll-container pb-8 -mx-6 px-6"> ${mockupsHtml} </div> </div> </div>`;
    },
    renderMarket(sheet) {
      if (!sheet || !sheet.data || sheet.data.length < 2) return '';
      const [eyebrow, title, , , , , , description] = (sheet.data[1] || []);
      const tiles = sheet.data.slice(2).map(r => ({
          title: r[2], body: r[3], value: r[4], badgeText: r[5],
          badgeTone: r[6], icon: r[7], style: r[8]
      })).filter(t => Object.values(t).some(val => val && String(val).trim()));
      
      const badgeClasses = (tone = 'violet') => ({
          green:  { bg: "bg-green-500/20",  text: "text-green-300"  },
          red:    { bg: "bg-red-500/20",    text: "text-red-300"    },
          blue:   { bg: "bg-blue-500/20",   text: "text-blue-300"   },
          violet: { bg: "bg-violet-500/20", text: "text-violet-300" },
          amber:  { bg: "bg-amber-500/20",  text: "text-amber-200"  },
          gray:   { bg: "bg-white/10",      text: "text-gray-300"   }
      }[String(tone).toLowerCase()] || { bg: "bg-violet-500/20", text: "text-violet-300" });

      const tilesHtml = tiles.map(t => {
          const styleLower = String(t.style || '').toLowerCase();
          const badgeHtml = t.badgeText ? `<span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${badgeClasses(t.badgeTone).bg} ${badgeClasses(t.badgeTone).text}">${Utils.applyGradient(t.badgeText)}</span>` : '';
          
          let widgetClasses = "kpi-widget flex flex-col h-full";
          let styleAttr = "";
          let wrapperClasses = "";

          if (styleLower === 'featured') { widgetClasses += " kpi-widget--featured"; }
          else if (styleLower === 'highlight') { widgetClasses += " kpi-widget--highlight"; }
          else if (styleLower === 'takeover') { widgetClasses += " kpi-widget--takeover"; wrapperClasses = "lg:col-span-2"; }
          else if (t.style) { widgetClasses += " kpi-widget--custom"; styleAttr = `style="--widget-accent-color: ${t.style};"`; }
          
          let innerHtml = '';
          if (styleLower === 'takeover') {
              innerHtml = `
                <div class="flex flex-col md:flex-row items-center gap-6 md:gap-8 h-full">
                  <div class="flex-shrink-0 flex flex-col items-center text-center md:items-start md:text-left">
                    ${t.icon ? `<div class="kpi-icon !w-12 !h-12">${this.renderIcon(t.icon)}</div>` : ''}
                    <h3 class="text-lg font-semibold text-gray-200 mt-4">${Utils.applyGradient(t.title)}</h3>
                    ${badgeHtml ? `<div class="mt-2">${badgeHtml}</div>` : ""}
                  </div>
                  <div class="md:border-l border-white/10 md:pl-8 text-center md:text-left">
                    ${t.value ? `<p class="text-5xl lg:text-6xl font-extrabold text-white">${Utils.applyGradient(t.value)}</p>` : ""}
                    ${t.body ? `<p class="mt-2 text-gray-300 max-w-xs">${Utils.applyGradient(t.body)}</p>` : ""}
                  </div>
                </div>`;
          } else {
              innerHtml = `
                <div>
                  <div class="flex justify-between items-start">
                    <h3 class="text-sm font-medium">${Utils.applyGradient(t.title)}</h3>
                    ${t.icon ? `<div class="kpi-icon">${this.renderIcon(t.icon)}</div>` : '<div class="kpi-icon" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-4 h-4 text-violet-300"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12h18M12 3v18"/></svg></div>'}
                  </div>
                  ${t.value ? `<p class="mt-4 text-4xl font-extrabold text-white">${Utils.applyGradient(t.value)}</p>` : ""}
                </div>
                <div class="flex-1"></div>
                <div>
                  ${badgeHtml ? `<div class="mt-2 flex items-center gap-2">${badgeHtml}</div>` : ""}
                  ${t.body ? `<p class="mt-4 text-gray-300">${Utils.applyGradient(t.body)}</p>` : ""}
                </div>`;
          }

          return `<div class="${wrapperClasses}"><div class="${widgetClasses}" ${styleAttr}>${innerHtml}</div></div>`;
      }).join('');

      return `
        <div class="max-w-7xl mx-auto text-center py-16 sm:py-24 px-6 lg:px-8">
            ${this.createSectionHeader({ eyebrow, title, description })}
            <div class="section-content">
                ${tiles.length ? `<div class="mt-16 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 text-left">${tilesHtml}</div>` : ''}
            </div>
        </div>`;
    },
    renderFooter(sheet) {
        if (!sheet || !sheet.data) return '';
        const [eyebrow, ...bodyParts] = (sheet.data[1] || []);
        const body = bodyParts.slice(0, 3).filter(Boolean).map(p => `<p class="mt-4 text-md text-gray-400">${Utils.applyGradient(String(p)).replace(/\n/g, "<br/>")}</p>`).join('');
        return `<div class="section-separator py-16 sm:py-24 px-6 lg:px-8"> <div class="max-w-4xl mx-auto text-center"> ${eyebrow ? `<p class="section-eyebrow mb-4">${Utils.applyGradient(eyebrow)}</p>` : ''} ${body} </div> </div>`;
    },
    renderRoadmap(sheet) {
        if (!sheet || !sheet.data || sheet.data.length < 2) return '';
        const [eyebrow, title, , description] = (sheet.data[1] || []);
        return `
            <div class="py-16 sm:py-24 px-6 lg:px-8">
                <div class="text-center mb-8">
                    ${eyebrow ? `<p class="section-eyebrow mb-4">${Utils.applyGradient(eyebrow)}</p>` : ''}
                    ${title ? `<h2 class="section-title text-4xl md:text-5xl font-extrabold tracking-tight">${Utils.applyGradient(title)}</h2>` : ''}
                    ${description ? `<p class="mt-4 max-w-3xl mx-auto text-lg text-gray-300">${Utils.applyGradient(description)}</p>` : ''}
                </div>
                <div class="coverflow-scene">
                    <div id="coverflow-container" class="coverflow-container"></div>
                </div>
                <div class="coverflow-nav">
                    <button id="coverflow-prev-button" class="nav-button">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <button id="coverflow-next-button" class="nav-button">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                </div>
            </div>`;
    }
  };

  const App = {
    passwordSet: new Set(),
    
    setupEventListeners() {
        DOM.unlockButton.addEventListener("click", () => this.handleUnlockAttempt());
        DOM.passwordInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") this.handleUnlockAttempt();
        });
        DOM.body.addEventListener('click', (event) => {
            if (window.innerWidth > 768) return;
            const header = event.target.closest(".section-header-mobile");
            if (!header) return;
            const content = header.nextElementSibling;
            if (!content || !content.classList.contains("section-content")) return;
            // NEW: Toggle the clicked section independently, instead of closing others.
            header.classList.toggle("expanded");
            content.classList.toggle("expanded");
        });
    },
    
    async fetchPasswordSetSafe() {
        const pwSet = new Set();
        for (const name of CONFIG.PASSWORD_TAB_NAMES) {
            try {
                const rows = await GSheetsAPI.fetchTab(name, "select A");
                for (let i = 1; i < rows.length; i++) {
                    const v = rows[i] && rows[i][0] != null ? String(rows[i][0]).trim() : "";
                    if (v) pwSet.add(v);
                }
                return pwSet;
            } catch (e) { continue; }
        }
        return pwSet;
    },

    async handleUnlockAttempt() {
        const password = DOM.passwordInput.value.trim();
        if (!password) {
            DOM.passwordError.textContent = "Please enter a password.";
            return;
        }
        this.setLoadingState(true);
        const pwSet = await this.fetchPasswordSetSafe();
        if (pwSet.size > 0 && !pwSet.has(password)) {
             DOM.passwordError.textContent = "Invalid password. Please try again.";
             this.setLoadingState(false);
             return;
        }
        await this.unlockPage();
        this.setLoadingState(false);
    },

    async unlockPage() {
      try {
        const content = await this.loadAllContent();
        this.renderAll(content);
        DOM.modal.classList.add("hidden");
        DOM.body.style.overflow = "auto";
        DOM.loadingIndicator.classList.add('hidden');
      } catch (error) {
        console.error("[App] Content loading/rendering error:", error);
        this.showFatalError("Could not load the investor update. The data sheet may be misconfigured.");
        throw error;
      }
    },
    
    setLoadingState(isLoading) {
        DOM.unlockButton.disabled = isLoading;
        DOM.unlockText.classList.toggle("hidden", isLoading);
        DOM.unlockSpinner.classList.toggle("hidden", !isLoading);
    },
    
    // NEW: Function to get section order. Fetches from `_config` sheet, otherwise uses hardcoded fallback.
    async getTabOrder() {
        try {
            const configData = await GSheetsAPI.fetchTab(CONFIG.CONFIG_TAB_NAME, "select A where A is not null");
            const customOrder = configData.map(row => row && row[0] && String(row[0]).trim()).filter(Boolean);
            if (customOrder.length > 0) {
                console.info(`[App] Using custom tab order from '${CONFIG.CONFIG_TAB_NAME}' sheet.`);
                return customOrder;
            }
        } catch (e) {
            // This is not a fatal error, we can fall back to the default.
            console.warn(`[App] Could not fetch '${CONFIG.CONFIG_TAB_NAME}' sheet. Using default order. Message: ${e.message}`);
        }
        console.info("[App] Using default tab order.");
        return CONFIG.TAB_ORDER;
    },

    async loadAllContent() {
      console.info("[App] Determining content tabs to load...");
      const initialTabOrder = await this.getTabOrder();

      // BUG FIX: Filter out any tab names that start with '#'.
      const tabNames = initialTabOrder
          .map(n => String(n || '').trim())
          .filter(name => name && !name.startsWith('#'))
          .map(name => name.toLowerCase());
      
      console.info("[App] Loading tabs:", tabNames);
      
      const promises = tabNames.map(name => 
        GSheetsAPI.fetchTab(name).catch(() => [])
      );
      const results = await Promise.all(promises);
      const contentMap = tabNames.reduce((acc, name, index) => {
        acc[name] = results[index];
        return acc;
      }, {});
      const titleName  = tabNames.find(n => CONFIG.TITLE_TAB_NAMES.includes(n)) || tabNames[0];
      const footerName = tabNames.find(n => CONFIG.FOOTER_TAB_NAMES.includes(n)) || tabNames[tabNames.length - 1];
      return {
        titleData: { name: titleName, data: contentMap[titleName] },
        footerData: { name: footerName, data: contentMap[footerName] },
        contentData: tabNames
          .filter(n => n !== titleName && n !== footerName)
          .map(n => ({ name: n, data: contentMap[n] }))
      };
    },
    
    renderAll({ titleData, footerData, contentData }) {
        if (!titleData || !footerData || !contentData) return;
        const rendererMap = { team: Renderers.renderTeam, partner: Renderers.renderTeam, product: Renderers.renderProduct, market: Renderers.renderMarket, roi: Renderers.renderMarket, traction: Renderers.renderStats, stat: Renderers.renderStats, momentum: Renderers.renderStats, roadmap: Renderers.renderRoadmap };
        DOM.header.innerHTML = Renderers.renderHero(titleData);
        DOM.footer.innerHTML = Renderers.renderFooter(footerData);
        DOM.main.innerHTML = '';

        contentData.forEach(sheet => {
            const name = sheet.name.toLowerCase();
            const rendererKey = Object.keys(rendererMap).find(key => name.includes(key));
            const renderFunc = (rendererKey ? rendererMap[rendererKey] : Renderers.renderStandard).bind(Renderers);
            const html = renderFunc(sheet);
            if(html && html.trim()){
              const wrapper = document.createElement("div");
              wrapper.className = "section-wrapper section-separator";
              wrapper.innerHTML = html;
              DOM.main.appendChild(wrapper);

              if (rendererKey === 'roadmap') {
                  this.setupRoadmap(sheet.data);
              }
            }
        });
        
        document.querySelectorAll(".hero-title, .section-title").forEach(Utils.wrapInitial);
        Utils.randomizeGradients();

        // NEW: On mobile, expand all sections by default after rendering.
        if (window.innerWidth <= 768) {
            document.querySelectorAll(".section-header-mobile").forEach(header => header.classList.add("expanded"));
            document.querySelectorAll(".section-content").forEach(content => content.classList.add("expanded"));
        }
    },

    setupRoadmap(sheetData) {
        const container = $("#coverflow-container");
        const prevButton = $("#coverflow-prev-button");
        const nextButton = $("#coverflow-next-button");
        if (!container || !prevButton || !nextButton) return;
        
        const cardData = sheetData.slice(1).map(row => ({
            eyebrow: row[5], title: row[6], description: row[7], tagText: row[8], tagColor: row[9]
        })).filter(d => d.title && String(d.title).trim());

        if (cardData.length === 0) {
            const roadmapSection = container.closest('.section-wrapper');
            if(roadmapSection) roadmapSection.style.display = 'none';
            return;
        }

        let currentIndex = 0;
        function getTagClasses(color = 'indigo') {
            const colorMap = { indigo: 'bg-indigo-500/20 text-indigo-300', green: 'bg-green-500/20 text-green-300', blue: 'bg-blue-500/20 text-blue-300', red: 'bg-red-500/20 text-red-300', amber: 'bg-amber-500/20 text-amber-300' };
            return colorMap[String(color).toLowerCase()] || colorMap.indigo;
        }
        cardData.forEach((data) => {
            const card = document.createElement('div');
            card.className = 'coverflow-card p-6 flex flex-col';
            const tagClasses = getTagClasses(data.tagColor);
            const tagHtml = data.tagText ? `<div class="mt-4 text-center"><span class="inline-block ${tagClasses} px-3 py-1 rounded-full text-sm font-medium">${data.tagText}</span></div>` : '';
            card.innerHTML = `<p class="section-eyebrow text-sm">${data.eyebrow}</p><h3 class="text-2xl font-bold mt-2" style="font-family: 'Lato', sans-serif;">${data.title}</h3><p class="text-gray-300 mt-4 flex-grow">${data.description}</p>${tagHtml}`;
            container.appendChild(card);
        });
        const cards = container.querySelectorAll('.coverflow-card');
        
        function updateLayout() {
            cards.forEach((card, index) => {
                const offset = index - currentIndex;
                let transform, opacity, zIndex, filter;
                if (offset === 0) {
                    transform = `translateZ(50px) rotateY(0) scale(1.05)`; opacity = 1; zIndex = cardData.length; filter = 'blur(0px)';
                } else if (offset === -1) {
                    transform = `translateX(-55%) translateZ(-100px) rotateY(45deg) rotateX(10deg) scale(0.9)`; opacity = 0.5; zIndex = cardData.length - 1; filter = 'blur(2px)';
                } else if (offset === 1) {
                    transform = `translateX(55%) translateZ(-100px) rotateY(-45deg) rotateX(10deg) scale(0.9)`; opacity = 0.5; zIndex = cardData.length - 1; filter = 'blur(2px)';
                } else {
                    transform = `translateX(${offset * 55}%) translateZ(-100px) rotateY(${offset > 0 ? -45 : 45}deg) rotateX(10deg) scale(0.9)`; opacity = 0; zIndex = cardData.length - Math.abs(offset); filter = 'blur(5px)';
                }
                card.style.transform = transform; card.style.opacity = opacity; card.style.zIndex = zIndex; card.style.filter = filter;
            });
            prevButton.disabled = currentIndex === 0;
            nextButton.disabled = currentIndex === cardData.length - 1;
        }
        prevButton.addEventListener('click', () => { if (currentIndex > 0) { currentIndex--; updateLayout(); } });
        nextButton.addEventListener('click', () => { if (currentIndex < cardData.length - 1) { currentIndex++; updateLayout(); } });
        updateLayout();
    },

    showFatalError(message) {
      const errorOverlay = document.createElement('div');
      errorOverlay.className = "fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4";
      errorOverlay.innerHTML = `<div class="bg-[#110d24] border border-red-500/50 rounded-2xl p-8 max-w-md w-full text-center shadow-2xl"><h1 class="text-2xl font-bold text-red-400">An Error Occurred</h1><p class="mt-4 text-gray-300">${message}</p><p class="mt-2 text-sm text-gray-500">Please check the developer console for details.</p></div>`;
      DOM.body.appendChild(errorOverlay);
      DOM.loadingIndicator.classList.add('hidden');
      DOM.body.style.overflow = "hidden";
    },
  };

  document.addEventListener("DOMContentLoaded", async () => {
    console.info("[App] Initializing...");
    App.setupEventListeners();
    try {
        const pwSet = await App.fetchPasswordSetSafe();
        if (pwSet.size === 0) {
            await App.unlockPage();
        } else {
            App.passwordSet = pwSet;
            DOM.loadingIndicator.classList.add('hidden');
            DOM.modal.classList.remove("hidden");
            DOM.modal.classList.add("flex");
            DOM.passwordInput.focus();
        }
    } catch (e) {
        console.error("[App] Initialization error:", e);
        App.showFatalError("Could not initialize the page. Please try again later.");
    }
  });

})();
</script>
</body>
</html>

