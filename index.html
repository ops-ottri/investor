<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ottri — Investor Update</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Lato:wght@800;900&display=swap" rel="stylesheet">

  <!-- Tailwind (CDN build is fine for GH Pages) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Page base */
    :root { color-scheme: dark; }
    html,body { height: 100%; }
    body {
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: #030014;
      color: #fff;
    }
    body::before {
      content: "";
      position: fixed; inset: 0;
      background: radial-gradient(circle at 50% -20%, rgba(76,36,159,.35) 0%, rgba(76,36,159,0) 45%);
      pointer-events: none; z-index: -1;
    }

    /* Section titling (matches your site) */
    .section-eyebrow {
      color: #9378ff; font-weight: 600; letter-spacing: .1em; text-transform: uppercase;
    }
    .section-title {
      font-family: 'Lato', sans-serif;
      font-weight: 800;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    /* Market/ROI widget styles */
    .kpi-widget{--hover-gradient:linear-gradient(120deg,#8B5CF6,#D946EF,#F97316);background:linear-gradient(145deg,rgba(255,255,255,.05),rgba(255,255,255,.02));backdrop-filter:blur(12px);border-radius:1rem;padding:1.5rem;border:1px solid rgba(255,255,255,.1);position:relative;overflow:hidden;transition:transform .3s ease,box-shadow .3s ease;transform:translateY(0);opacity:0;animation:fadeInUp .6s ease-out forwards}
    .kpi-widget:hover{transform:translateY(-8px);box-shadow:0 20px 40px rgba(0,0,0,.4)}
    .kpi-widget::before{content:"";position:absolute;inset:0;border-radius:1rem;padding:2px;background:var(--hover-gradient);-webkit-mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);-webkit-mask-composite:destination-out;mask-composite:exclude;opacity:0;transition:opacity .4s ease-in-out}
    .kpi-widget:hover::before{opacity:1}
    @keyframes fadeInUp{from{opacity:0;transform:translateY(25px)}to{opacity:1;transform:translateY(0)}}
    .kpi-badge{display:inline-flex;align-items:center;gap:.25rem;padding:.125rem .5rem;border-radius:.75rem;font-size:.7rem;font-weight:600}
    .badge-green{background:rgba(34,197,94,.18);color:#86efac}
    .badge-blue{background:rgba(59,130,246,.18);color:#93c5fd}
    .badge-purple{background:rgba(139,92,246,.18);color:#c4b5fd}
    .badge-gold{background:rgba(234,179,8,.18);color:#fde68a}
    .kpi-icon{width:2rem;height:2rem;display:flex;align-items:center;justify-content:center;border-radius:.5rem;background:rgba(139,92,246,.08);color:#c4b5fd}
    .market-eyebrow{color:#9378ff;font-weight:600;letter-spacing:.1em;text-transform:uppercase}

    /* Simple separators to keep your existing feel */
    .rule { height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.1),transparent); }
  </style>
</head>
<body class="antialiased">

  <!-- HERO (kept minimal so rest of your page continues to render) -->
  <header class="max-w-7xl mx-auto text-center px-6 lg:px-8 pt-12 pb-14">
    <h1 class="section-title text-5xl md:text-6xl tracking-tight">Investor Update</h1>
    <p class="mt-4 text-gray-300">October 2025</p>
  </header>

  <div class="rule max-w-6xl mx-auto opacity-60"></div>

  <!-- ===== MARKET & ROI SECTION (from your Sheet) ===== -->
  <section id="market" class="py-24">
    <div class="max-w-7xl mx-auto px-6 lg:px-8">
      <div class="text-center mb-12">
        <p id="market-eyebrow" class="market-eyebrow mb-4">MARKET & ROI</p>
        <h2 id="market-hero" class="section-title text-4xl md:text-5xl tracking-tight text-white">Loading…</h2>
        <p id="market-desc" class="mt-4 max-w-3xl mx-auto text-lg text-gray-300"></p>
      </div>

      <div id="market-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 text-left"></div>
    </div>
  </section>

  <div class="rule max-w-6xl mx-auto opacity-60"></div>

  <!-- ===== Any other sections you already have can stay below this line ===== -->
  <section class="py-24">
    <div class="max-w-5xl mx-auto px-6 lg:px-8 text-center">
      <p class="section-eyebrow mb-4">Next Section Placeholder</p>
      <h2 class="section-title text-4xl tracking-tight">Roadmap</h2>
      <p class="mt-4 text-gray-400">This is just a placeholder to ensure the rest of the page still renders.</p>
    </div>
  </section>

  <!-- ================== DATA + RENDER SCRIPT ================== -->
  <script>
  ;(function(){
    // ----------------- OPTIONAL CSV FALLBACK -----------------
    // If (and only if) you ever want to bypass your existing loader,
    // publish the "market" tab to CSV and paste the URL below:
    const MARKET_CSV = ""; // e.g. "https://docs.google.com/spreadsheets/d/.../pub?gid=XXXXX&single=true&output=csv"
    // Leave as "" to keep using your current loader (window.dataByTab or window.SHEETS).

    // ----------------- helpers -----------------
    const $ = (id) => document.getElementById(id);
    const safe = (v) => (v==null ? "" : String(v));
    const toneClass = (tone) => {
      const k = safe(tone).toLowerCase();
      if(k==="green") return "badge-green";
      if(k==="blue")  return "badge-blue";
      if(k==="gold")  return "badge-gold";
      return "badge-purple";
    };
    const randomizeHoverGradient = (el) => {
      const colors = ["#8B5CF6","#D946EF","#F97316","#3B82F6","#EC4899","#22D3EE"];
      const n = 2 + Math.floor(Math.random()*2); // 2 or 3
      const order = colors.slice().sort(()=>Math.random()-0.5).slice(0,n);
      const angle = Math.floor(Math.random()*180);
      el.style.setProperty("--hover-gradient", `linear-gradient(${angle}deg, ${order.join(", ")})`);
    };

    // ----------------- parse the exact layout you showed -----------------
    function parseMarketSheet(rows){
      // rows = array of arrays from your "market" tab
      if(!Array.isArray(rows) || rows.length===0) return null;

      // Header row for the section (A1/B1/C1)
      const secHeaders = rows[0] || [];
      const okA = safe(secHeaders[0]).toLowerCase() === "eyebrow";
      const okB = safe(secHeaders[1]).toLowerCase() === "hero_title";
      const okC = safe(secHeaders[2]).toLowerCase() === "description";
      if(!(okA && okB && okC)) return null;

      // Section values (A2/B2/C2)
      const secVals = rows[1] || [];
      const eyebrow = safe(secVals[0]);
      const hero    = safe(secVals[1]);
      const desc    = safe(secVals[2]);

      // Find KPI header row anywhere (A? = 'title', B? = 'description', C? = 'value', ...)
      const kpiHeaderIndex = rows.findIndex(r =>
        Array.isArray(r) &&
        safe(r[0]).toLowerCase()==="title" &&
        safe(r[1]).toLowerCase()==="description"
      );

      const items = [];
      if(kpiHeaderIndex >= 0){
        for(let i=kpiHeaderIndex+1;i<rows.length;i++){
          const r = rows[i] || [];
          // stop/skip fully empty lines
          const empty = safe(r[0])==="" && safe(r[1])==="" && safe(r[2])==="";
          if(empty) continue;

          items.push({
            title: safe(r[0]),
            description: safe(r[1]),
            value: safe(r[2]),
            badge: safe(r[3]),
            color: safe(r[4]),
            icon:  safe(r[5])
          });
        }
      }

      return { eyebrow, hero, desc, items };
    }

    // ----------------- render -----------------
    function renderMarket(data){
      if(!data) return;

      $("market-eyebrow").textContent = data.eyebrow || "MARKET & ROI";
      $("market-hero").textContent    = data.hero || "";
      $("market-desc").textContent    = data.desc || "";

      const grid = $("market-grid");
      grid.innerHTML = "";

      data.items.forEach((it, idx) => {
        if(!it.title && !it.description && !it.value) return;

        const badgeHTML = it.badge
          ? `<span class="kpi-badge ${toneClass(it.color)}">${it.badge}</span>` : "";

        const valueHTML = it.value
          ? `<p class="mt-3 text-4xl font-bold text-white tracking-tight">${it.value}</p>` : "";

        const iconHTML = it.icon
          ? `<div class="kpi-icon" title="${it.icon}">+</div>`
          : `<div class="kpi-icon" aria-hidden="true">+</div>`;

        const card = document.createElement("div");
        card.className = "kpi-widget";
        card.style.animationDelay = (0.1*(idx+1))+"s";
        card.innerHTML = `
          <div class="flex justify-between items-start">
            <h3 class="text-sm font-medium text-gray-400">${it.title||""}</h3>
            ${iconHTML}
          </div>
          ${valueHTML}
          <div class="mt-2 flex items-center gap-2">
            ${badgeHTML}
          </div>
          <p class="mt-3 text-sm text-gray-300 leading-6">${it.description||""}</p>
        `;
        card.addEventListener("mouseenter", ()=>randomizeHoverGradient(card));
        grid.appendChild(card);
      });
    }

    // ----------------- data sources (in this order) -----------------
    function getFromExistingLoader(){
      if (window.dataByTab && Array.isArray(window.dataByTab.market)) {
        return window.dataByTab.market;
      }
      if (window.SHEETS && Array.isArray(window.SHEETS.market)) {
        return window.SHEETS.market;
      }
      return null;
    }

    function csvToArrays(text){
      // tiny CSV parser that handles commas in quotes
      const rows = [];
      let cur = [], val = "", inQ = false;
      for(let i=0;i<text.length;i++){
        const ch = text[i], nxt = text[i+1];
        if(ch==='\"'){
          if(inQ && nxt==='\"'){ val+='\"'; i++; }
          else inQ = !inQ;
        } else if(ch===',' && !inQ){
          cur.push(val); val="";
        } else if((ch==='\n' || ch==='\r') && !inQ){
          if(val!=="" || cur.length){ cur.push(val); rows.push(cur); cur=[]; val=""; }
        } else {
          val += ch;
        }
      }
      if(val!=="" || cur.length){ cur.push(val); rows.push(cur); }
      return rows;
    }

    async function getFromCSV(){
      if(!MARKET_CSV) return null;
      try{
        const res = await fetch(MARKET_CSV, { cache: "no-store" });
        if(!res.ok) return null;
        const txt = await res.text();
        return csvToArrays(txt);
      }catch{ return null; }
    }

    // ----------------- boot -----------------
    async function start(){
      // 1) try immediately from your existing loader
      let rows = getFromExistingLoader();
      if(rows){
        const parsed = parseMarketSheet(rows);
        if(parsed){ renderMarket(parsed); return; }
      }

      // 2) listen for your loader’s “late” event
      let rendered = false;
      window.addEventListener("sheet-data-ready", (ev)=>{
        if(rendered) return;
        const market = ev?.detail?.market || getFromExistingLoader();
        if(Array.isArray(market)){
          const parsed = parseMarketSheet(market);
          if(parsed){ rendered = true; renderMarket(parsed); }
        }
      }, { once:true });

      // 3) also do a short retry loop (covers non-event async loaders)
      let tries = 0;
      const t = setInterval(()=>{
        if(rendered || tries++>40) return clearInterval(t); // ~4s
        const again = getFromExistingLoader();
        if(Array.isArray(again)){
          const parsed = parseMarketSheet(again);
          if(parsed){ rendered = true; clearInterval(t); renderMarket(parsed); }
        }
      },100);

      // 4) optional CSV fallback (only if MARKET_CSV is set)
      if(!rendered && MARKET_CSV){
        const csvRows = await getFromCSV();
        if(Array.isArray(csvRows)){
          const parsed = parseMarketSheet(csvRows);
          if(parsed){ rendered = true; renderMarket(parsed); }
        }
      }
    }
    start();
  })();
  </script>
</body>
</html>
