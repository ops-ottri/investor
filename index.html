<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ottri Investor Update</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #0B0214;
      color: white;
    }
    .title-gradient {
      background: linear-gradient(90deg, #8B5CF6, #D946EF);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .kpi-widget {
      background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
      backdrop-filter: blur(12px);
      border-radius: 1rem;
      padding: 1.5rem;
      border: 1px solid rgba(255,255,255,0.08);
      transition: all 0.3s ease;
    }
    .kpi-widget:hover {
      transform: translateY(-3px);
      border-color: rgba(255,255,255,0.18);
    }
  </style>
</head>

<body class="min-h-screen flex flex-col justify-center">

  <!-- ============ MARKET / ROI SECTION ============ -->
  <section id="market" class="py-24 sm:py-28">
    <div class="max-w-7xl mx-auto px-6 lg:px-8">
      <div id="market-root"></div>
    </div>
  </section>

  <!-- ============================================== -->
  <script>
  /* ===========================================================
     MARKET / ROI â€” schema-based parser that matches your sheet
     (Row1: eyebrow|hero_title|description, Row2: values,
      Row4: KPI headers, Row5+: KPI rows)
     =========================================================== */

  function _trim(v){ return (v==null?'':String(v)).trim(); }
  function _lower(v){ return _trim(v).toLowerCase(); }
  function _emptyRow(r){ return !r || r.every(c => _trim(c)===''); }

  /** Convert a 2-D array of the "market" tab into {header, cards} */
  function parseMarketSheet(rows){
    const R = (rows || []).map(r => (r || []).map(_trim));

    // 1) Find the header-label row
    let headerLabelRow = -1;
    for(let i=0;i<R.length;i++){
      const set = new Set(R[i].map(_lower));
      if (set.has('eyebrow') && set.has('hero_title') && set.has('description')){
        headerLabelRow = i; break;
      }
    }

    // 2) Take the first non-empty row after that as the header-value row
    const header = {eyebrow:'', hero_title:'', description:''};
    if (headerLabelRow >= 0){
      const indexOf = {};
      R[headerLabelRow].forEach((h, j)=> indexOf[_lower(h)] = j);
      for(let i=headerLabelRow+1;i<R.length;i++){
        if(!_emptyRow(R[i])){
          header.eyebrow     = R[i][indexOf['eyebrow']]     || '';
          header.hero_title  = R[i][indexOf['hero_title']]  || '';
          header.description = R[i][indexOf['description']] || '';
          break;
        }
      }
    }

    // 3) Find KPI header row
    const known = new Set(['title','description','value','badge','color','icon']);
    let kpiHeaderRow = -1, kpiCols = {};
    for (let i=0;i<R.length;i++){
      const lower = R[i].map(_lower);
      const hasTitle = lower.includes('title');
      const overlap = lower.filter(x => known.has(x)).length;
      if (hasTitle && overlap >= 2){
        kpiHeaderRow = i;
        lower.forEach((name, j)=>{ if(known.has(name)) kpiCols[name]=j; });
        break;
      }
    }

    // 4) Collect KPI rows
    const cards = [];
    if (kpiHeaderRow >= 0){
      for (let i=kpiHeaderRow+1; i<R.length; i++){
        if (_emptyRow(R[i])) break;
        const title = kpiCols.title!=null ? R[i][kpiCols.title] : '';
        if (!title) continue;
        cards.push({
          title,
          description: kpiCols.description!=null ? R[i][kpiCols.description] : '',
          value:       kpiCols.value!=null       ? R[i][kpiCols.value]       : '',
          badge:       kpiCols.badge!=null       ? R[i][kpiCols.badge]       : '',
          color:       kpiCols.color!=null       ? R[i][kpiCols.color]       : '',
          icon:        kpiCols.icon!=null        ? R[i][kpiCols.icon]        : ''
        });
      }
    }

    return { header, cards };
  }

  /* ---------- Styling helpers ---------- */
  function pillToneClasses(tone){
    const t = (_trim(tone)).toLowerCase();
    if (t==='green') return 'bg-green-500/20 text-green-300';
    if (t==='blue')  return 'bg-blue-500/20 text-blue-300';
    if (t==='purple')return 'bg-violet-500/20 text-violet-300';
    if (t==='gold')  return 'bg-amber-500/20 text-amber-300';
    return 'bg-violet-500/20 text-violet-300';
  }
  function iconGlyph(name){
    const n = (_trim(name)).toLowerCase();
    if (n==='chart' || n==='growth'){
      return '<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 opacity-80" viewBox="0 0 24 24" fill="currentColor"><path d="M4 19h16v2H4z"/><path d="M7 10h3v7H7zM11 6h3v11h-3zM15 13h3v4h-3z"/></svg>';
    }
    return '<svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 opacity-80" viewBox="0 0 24 24" fill="currentColor"><path d="M11 5h2v14h-2z"/><path d="M5 11h14v2H5z"/></svg>';
  }

  /* ---------- Renderer ---------- */
  function renderMarketSection(rows){
    const root = document.getElementById('market-root');
    if (!root) return;

    const {header, cards} = parseMarketSheet(rows || []);
    let html = '';

    // Eyebrow
    if (header.eyebrow){
      html += `<p class="text-center text-sm font-medium text-violet-400 mb-4">${header.eyebrow}</p>`;
    }

    // Big title
    if (header.hero_title){
      html += `<h2 class="text-center text-4xl md:text-5xl font-extrabold mb-4">
                <span class="title-gradient">${header.hero_title}</span>
               </h2>`;
    }

    // Subtitle
    if (header.description){
      html += `<p class="text-center text-lg text-gray-300 mb-12">${header.description}</p>`;
    }

    // KPI Cards
    if (cards.length){
      html += `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">`;
      for (const c of cards){
        const badge = _trim(c.badge)
          ? `<span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${pillToneClasses(c.color)}">${_trim(c.badge)}</span>`
          : '';
        const icon = iconGlyph(c.icon);

        html += `
        <div class="kpi-widget">
          <div class="flex justify-between items-start">
            <h3 class="text-sm font-medium text-gray-400">${_trim(c.title)}</h3>
            <div class="w-7 h-7 flex items-center justify-center bg-violet-500/10 rounded-lg">${icon}</div>
          </div>
          ${_trim(c.value) ? `<p class="mt-4 text-4xl font-extrabold text-white">${_trim(c.value)}</p>` : ''}
          ${badge ? `<div class="mt-3">${badge}</div>` : ''}
          ${_trim(c.description) ? `<p class="mt-3 text-sm text-gray-300 leading-6">${_trim(c.description)}</p>` : ''}
        </div>`;
      }
      html += `</div>`;
    }

    root.innerHTML = html;
  }

  /* ---------- Data Hook ---------- */
  (function autoRenderMarket(){
    try {
      if (window.dataByTab && window.dataByTab.market){
        renderMarketSection(window.dataByTab.market);
        return;
      }
      if (window.SHEETS && window.SHEETS.market){
        renderMarketSection(window.SHEETS.market);
        return;
      }
    } catch(e){}
    window.addEventListener('sheet-data-ready', (ev)=>{
      try{
        const marketRows = (ev.detail && ev.detail.market) || (window.dataByTab && window.dataByTab.market);
        if (marketRows) renderMarketSection(marketRows);
      }catch(e){}
    });
  })();
  </script>
</body>
</html>
