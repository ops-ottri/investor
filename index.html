<!DOCTYPE html>
<html>
<head>
  <title>Ottri Investor Update</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- GViz perf hints -->
  <link rel="dns-prefetch" href="https://docs.google.com">
  <link rel="preconnect" href="https://docs.google.com" crossorigin>

  <!-- Inter (UI) + Lato (titles) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Lato:wght@800;900&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Preload your stencil font (same folder as index.html) -->
  <link rel="preload" as="font" href="L-7%20Stencil.ttf" type="font/ttf" crossorigin>

  <style>
    :root{
      /* Tune these two if weights look off */
      --title-weight: 850;    /* body of each title (Lato) */
      --stencil-weight: 1200;  /* first letter (L7 Stencil) */
    }

    /* ===== Custom stencil font (uploaded file) =====
       If your TTF is a variable font, declaring a weight range helps. */
    @font-face{
      font-family:"L7Stencil";
      src:url("L-7%20Stencil.ttf") format("truetype");
      font-display:swap;
      font-weight:100 950; /* enables variable/weight matching if supported */
      font-style:normal;
    }

    /* ===== Base ===== */
    body{font-family:'Inter',sans-serif;background-color:#030014;color:#fff}
    .section-eyebrow{color:#9378ff;font-weight:600;letter-spacing:.1em;text-transform:uppercase}
    body::before{content:'';position:fixed;inset:0;background:
      radial-gradient(circle at top,rgba(76,36,159,.3) 0%,rgba(76,36,159,0) 40%);
      z-index:-1;pointer-events:none}
    .loader{border:4px solid rgba(255,255,255,.2);border-top:4px solid #9378ff;border-radius:50%;
      width:40px;height:40px;animation:spin 1s linear infinite}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    .title-gradient{background:linear-gradient(90deg,#F97316,#D946EF,#8B5CF6);
      -webkit-background-clip:text;background-clip:text;color:transparent}
    .section-separator{position:relative}
    .section-separator::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);
      width:90%;max-width:1280px;border-top:1px solid rgba(255,255,255,.1)}
    @keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.7;transform:scale(1.1)}}

    /* ===== Mobile accordion ===== */
    @media (max-width:768px){
      .section-header-mobile{cursor:pointer}
      .section-content{max-height:0;overflow:hidden;transition:max-height .45s ease}
      .section-content.expanded{max-height:5000px}
      .chevron-indicator{transition:transform .3s ease;animation:pulse 2.5s infinite cubic-bezier(.4,0,.6,1)}
      .section-header-mobile.expanded .chevron-indicator{transform:rotate(180deg);animation:none}
    }

    /* ===== Titles — Lato for body, L7 Stencil for first letter ===== */
    .hero-title,
    .section-title{
      font-family:'Lato',sans-serif;
      font-weight:var(--title-weight);
      -webkit-font-smoothing:antialiased;
      text-rendering:optimizeLegibility;
    }
    .hero-title::first-letter,
    .section-title::first-letter{
      font-family:"L7Stencil",'Lato',sans-serif;
      /* Force heavier stencil */
      font-weight:var(--stencil-weight);
      font-variation-settings:"wght" var(--stencil-weight); /* if variable */
      /* Keep metrics identical so it blends */
      font-size:1em; line-height:inherit; letter-spacing:inherit; display:inline;
      -webkit-font-smoothing:antialiased;
    }

    /* Print deterrent */
    @media print{body{display:none!important}}
  </style>
</head>
<body class="antialiased" style="overflow:hidden;">

  <!-- Password Modal -->
  <div id="password-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4">
    <div class="bg-[#110d24] border border-white/10 rounded-2xl p-8 max-w-sm w-full text-center shadow-2xl">
      <h2 class="text-2xl font-bold text-white">Access Required</h2>
      <p class="mt-2 text-gray-400">Please enter the password to view this update.</p>
      <input type="password" id="password-input" class="mt-6 w-full bg-gray-900/50 border border-white/20 rounded-lg p-3 text-white text-center focus:ring-2 focus:ring-[#9378ff] focus:outline-none" placeholder="••••••••" autocomplete="current-password">
      <p id="password-error" class="text-red-400 text-sm mt-2 h-5"></p>
      <button id="unlock-button" class="mt-4 w-full bg-[#9378ff] hover:bg-[#8162ff] text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 flex items-center justify-center">
        <span id="unlock-text">Unlock</span>
        <div id="unlock-spinner" class="loader w-6 h-6 border-2 hidden" aria-hidden="true"></div>
      </button>
    </div>
  </div>
  
  <header id="header-container" class="hidden"></header>
  <main id="content-container" class="hidden"></main>
  <footer id="footer-container" class="hidden"></footer>

<script>
/* =======================
   CONFIG
   ======================= */
const SHEET_ID = "1sJQIQuUWe0sOrytSmJj0siTsuAR5ZNL2MEpcZsyBYUc";
const TAB_ORDER = ["title","intro","team","momentum","product","roadmap","market","partners","vision","footer"];
const TITLE_TABS  = ["title","hero","header"];
const FOOTER_TABS = ["footer","foot","end"];
// SHA-256 of "iloveottri"
const PASSWORD_SHA256 = "903c8a8eb1cc4a21747ceb0d3ddb3419d6b94dd8d37cf64ffb37ce00f69cfff8";

/* =======================
   Helpers
   ======================= */
const GRADIENT_RE=/\*(.*?)\*/g;
function applyGradient(text){return(!text||typeof text!=='string')?'':text.replace(GRADIENT_RE,'<span class="title-gradient">$1</span>');}

function setupAccordion(){
  if(window.innerWidth>768) return;
  const root=document.getElementById('content-container');
  root.addEventListener('click',e=>{
    const header=e.target.closest('.section-header-mobile'); if(!header) return;
    const content=header.nextElementSibling; if(!content||!content.classList.contains('section-content')) return;
    const open=header.classList.contains('expanded');
    root.querySelectorAll('.section-header-mobile.expanded').forEach(h=>{
      if(h!==header){h.classList.remove('expanded');h.nextElementSibling?.classList.remove('expanded');}
    });
    header.classList.toggle('expanded',!open);
    content.classList.toggle('expanded',!open);
  });
}

function showError(error){
  const container=document.getElementById('content-container')||document.body;
  const msg=error?.message?error.message:(typeof error==='string'?error:JSON.stringify(error));
  container.innerHTML =
    '<div class="flex items-center justify-center min-h-screen text-center px-6">'+
      '<div><h2 class="text-2xl font-semibold text-red-400">An Error Occurred</h2>'+
      '<p class="mt-2 text-gray-300">Could not load data from the spreadsheet.</p>'+
      '<p class="mt-4 p-4 bg-red-900/50 text-red-300 rounded-lg text-left text-sm font-mono">'+msg+'</p></div></div>';
  document.getElementById('password-modal').style.display='none';
  container.classList.remove('hidden');
}

/* =======================
   GViz fetch
   ======================= */
function gvizUrl(name){return `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(name)}&tq=${encodeURIComponent("select *")}`;}
function parseGViz(txt){
  const s=txt.indexOf('{'), e=txt.lastIndexOf('}');
  if(s===-1||e===-1) throw new Error("Bad GViz response");
  const json=JSON.parse(txt.slice(s,e+1));
  const rows=(json.table?.rows||[]).map(r=>(r.c||[]).map(c=>c&&c.v!=null?c.v:null));
  return rows;
}
async function fetchTab(n){
  const res=await fetch(gvizUrl(n),{cache:'no-store'});
  if(!res.ok) throw new Error(`Fetch failed for tab "${n}" (${res.status})`);
  const txt=await res.text();
  return parseGViz(txt);
}
async function loadFromSheets(){
  const names=TAB_ORDER.map(n=>n.toLowerCase());
  const results={};
  await Promise.all(names.map(async n=>{
    try{ results[n]=await fetchTab(n); }catch(e){ console.warn('Tab load failed:',n,e); results[n]=[]; }
  }));
  const titleName = names.find(n=>TITLE_TABS.includes(n)) || names[0];
  const footerName= names.find(n=>FOOTER_TABS.includes(n)) || names[names.length-1];
  return {
    titleData:  {name:titleName,  data:results[titleName]  || []},
    footerData: {name:footerName, data:results[footerName] || []},
    contentData: names.filter(n=>n!==titleName && n!==footerName).map(n=>({name:n, data:results[n]||[]}))
  };
}

/* =======================
   Renderers
   ======================= */
function renderHeroSection(sheet){
  const data=sheet.data||[];
  if(data.length<2) return '';
  const row=data[1]||[];
  const title   = String(row[0] ?? '');
  const subtitle= String(row[1] ?? '');
  const logoUrl = String(row[2] ?? '');

  let html = '<div class="text-center py-16 sm:py-20 px-6 lg:px-8">';
  if(logoUrl) html += `<img class="max-h-48 w-auto mx-auto mb-8" src="${logoUrl}" alt="Ottri Logo" loading="lazy">`;
  if(title)   html += `<h1 class="hero-title text-4xl font-bold tracking-tight sm:text-6xl leading-snug sm:leading-snug">${applyGradient(title)}</h1>`;
  if(subtitle)html += `<p class="mt-4 text-lg leading-8 text-gray-300">${applyGradient(subtitle)}</p>`;
  html += '</div>';
  return html;
}

function renderStandardSection(sheet){
  const data=sheet.data||[]; if(data.length<2) return '';
  const header=data[1]||[];
  const eyebrow=String(header[0] ?? '');
  const title  =String(header[1] ?? '');
  const description=String(header[7] ?? '');
  const paras=[];
  for(let i=1;i<data.length;i++){ if(data[i] && data[i][2]!=null) paras.push(String(data[i][2])); }

  let html = '<div class="max-w-4xl mx-auto text-center py-16 sm:py-24 px-6 lg:px-8">';
  html += '<div class="section-header-mobile">';
  if(eyebrow) html += `<p class="section-eyebrow mb-4">${applyGradient(eyebrow)}</p>`;
  if(title)   html += `<h2 class="section-title text-4xl md:text-5xl font-extrabold tracking-tight">${applyGradient(title)}</h2>`;
  if(description) html += `<p class="mt-4 max-w-3xl mx-auto text-lg text-gray-300">${applyGradient(description)}</p>`;
  html += '<div class="md:hidden flex justify-center mt-6"><svg class="chevron-indicator w-6 h-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></div>';
  html += '</div><div class="section-content">';
  paras.forEach(p=> html += `<p class="mt-6 max-w-2xl mx-auto text-lg text-gray-300 text-center">${applyGradient(p.replace(/\n/g,'<br/>'))}</p>`);
  html += '</div></div>';
  return html;
}

function renderTeamSection(sheet){
  const data=sheet.data||[]; if(data.length<2) return '';
  const header=data[1]||[];
  const eyebrow=String(header[0] ?? '');
  const title  =String(header[1] ?? '');
  const description=String(header[7] ?? '');
  const members=data.slice(2).filter(r=>r && r.some(c=>String(c??'').trim()!==''));

  let html = '<div class="max-w-6xl mx-auto text-center py-16 sm:py-24 px-6 lg:px-8">';
  html += '<div class="section-header-mobile">';
  if(eyebrow) html += `<p class="section-eyebrow mb-4">${applyGradient(eyebrow)}</p>`;
  if(title)   html += `<h2 class="section-title text-4xl md:text-5xl font-extrabold tracking-tight">${applyGradient(title)}</h2>`;
  if(description) html += `<p class="mt-4 max-w-3xl mx-auto text-lg text-gray-300">${applyGradient(description)}</p>`;
  html += '<div class="md:hidden flex justify-center mt-6"><svg class="chevron-indicator w-6 h-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></div>';
  html += '</div><div class="section-content">';

  if(members.length){
    let grid = '<div class="mt-12 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">';
    members.forEach(m=>{
      const name=String(m[2] ?? '');
      const job =String(m[4] ?? '');
      const bio =String(m[5] ?? '');
      const img =String(m[3] ?? '');
      const initials=(name.split(' ').map(n=>n[0]).join('')||'??').toUpperCase();
      const ph=`https://placehold.co/256x256/4B5563/FFFFFF?text=${encodeURIComponent(initials)}`;
      const src= img || ph;
      grid +=
        '<div class="text-center bg-gray-800/30 backdrop-blur-sm rounded-xl p-8 border border-white/10">'+
          `<img class="w-32 h-32 rounded-full mx-auto object-cover mb-4 border-4 border-white/10" src="${src}" alt="${name}" loading="lazy" onerror="this.onerror=null;this.src='${ph}'">`+
          `<h3 class="text-xl font-bold tracking-tight text-white">${applyGradient(name)}</h3>`+
          (job?`<p class="text-indigo-300">${applyGradient(job)}</p>`:'')+
          (bio?`<p class="mt-2 text-gray-400 text-sm">${applyGradient(bio)}</p>`:'')+
        '</div>';
    });
    grid += '</div>';
    html += grid;
  }

  html += '</div></div>';
  return html;
}

function renderStatsSection(sheet){
  const data=sheet.data||[]; if(data.length<2) return '';
  const header=data[1]||[];
  const eyebrow=String(header[0] ?? '');
  const title  =String(header[1] ?? '');
  const description=String(header[7] ?? '');
  const stats=data.slice(2).filter(r=>r && r.some(c=>String(c??'').trim()!==''));

  let html = '<div class="max-w-5xl mx-auto text-center py-16 sm:py-24 px-6 lg:px-8">';
  html += '<div class="section-header-mobile">';
  if(eyebrow) html += `<p class="section-eyebrow mb-4">${applyGradient(eyebrow)}</p>`;
  if(title)   html += `<h2 class="section-title text-4xl md:text-5xl font-extrabold tracking-tight">${applyGradient(title)}</h2>`;
  if(description) html += `<p class="mt-4 max-w-3xl mx-auto text-lg text-gray-300">${applyGradient(description)}</p>`;
  html += '<div class="md:hidden flex justify-center mt-6"><svg class="chevron-indicator w-6 h-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></div>';
  html += '</div><div class="section-content">';

  if(stats.length){
    let grid = '<div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-8">';
    stats.forEach(s=>{
      const value=String(s[0] ?? '');
      const st   =String(s[1] ?? '');
      const desc =String(s[2] ?? '');
      grid +=
        '<div class="bg-gray-800/30 backdrop-blur-sm rounded-xl p-8 border border-white/10 text-center">'+
          `<p class="text-4xl md:text-5xl font-extrabold text-[#9378ff]">${applyGradient(value)}</p>`+
          `<h3 class="mt-2 text-lg font-semibold text-white">${applyGradient(st)}</h3>`+
          `<p class="mt-1 text-gray-400">${applyGradient(desc.replace(/\n/g,'<br/>'))}</p>`+
        '</div>';
    });
    grid += '</div>';
    html += grid;
  }

  html += '</div></div>';
  return html;
}

function renderFooterSection(sheet){
  const data=sheet.data||[]; if(data.length<2) return '';
  const row=data[1]||[];
  const eyebrow=String(row[0] ?? '');
  let body='';
  [1,2,3].forEach(i=>{
    const v=String(row[i] ?? '');
    if(v) body += `<p class="mt-4 text-md text-gray-400">${applyGradient(v.replace(/\n/g,'<br/>'))}</p>`;
  });
  let html = '<div class="section-separator py-16 sm:py-24 px-6 lg:px-8"><div class="max-w-4xl mx-auto text-center">';
  if(eyebrow) html += `<p class="section-eyebrow mb-4">${applyGradient(eyebrow)}</p>`;
  html += body + '</div></div>';
  return html;
}

function renderPage(res){
  if(!res || (!res.titleData && !res.contentData && !res.footerData)){
    showError({message:"Empty data from sheet."}); return;
  }
  const main=document.getElementById('content-container');
  const head=document.getElementById('header-container');
  const foot=document.getElementById('footer-container');

  if(res.titleData) head.innerHTML = renderHeroSection(res.titleData);

  main.innerHTML='';
  if(res.contentData?.length){
    res.contentData.forEach(sheet=>{
      const name=(sheet.name||'').toLowerCase();
      let html='';
      if(name.includes('team')||name.includes('partner')) html = renderTeamSection(sheet);
      else if(name.includes('traction')||name.includes('stat')||name.includes('momentum')) html = renderStatsSection(sheet);
      else html = renderStandardSection(sheet);
      const wrapper=document.createElement('div');
      wrapper.className='section-wrapper section-separator';
      wrapper.innerHTML=html;
      main.appendChild(wrapper);
    });
  }

  if(res.footerData) foot.innerHTML = renderFooterSection(res.footerData);

  head.classList.remove('hidden');
  main.classList.remove('hidden');
  foot.classList.remove('hidden');

  setupAccordion();
}

/* =======================
   Password
   ======================= */
async function sha256Hex(s){
  const enc=new TextEncoder().encode(s);
  const buf=await crypto.subtle.digest('SHA-256',enc);
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
}
async function unlock(){
  const input=document.getElementById('password-input');
  const err=document.getElementById('password-error');
  const btn=document.getElementById('unlock-button');
  const txt=document.getElementById('unlock-text');
  const spin=document.getElementById('unlock-spinner');

  const pw=(input.value||'').trim();
  if(!pw){err.textContent='Please enter a password.';return;}

  err.textContent=''; txt.classList.add('hidden'); spin.classList.remove('hidden'); btn.disabled=true;

  try{
    const hash=await sha256Hex(pw);
    if(hash!==PASSWORD_SHA256.toLowerCase()){err.textContent='Invalid password. Please try again.';return;}
    document.getElementById('password-modal').style.display='none';
    document.body.style.overflow='auto';
    const data=await loadFromSheets().catch(showError);
    if(data) renderPage(data);
  }finally{
    txt.classList.remove('hidden'); spin.classList.add('hidden'); btn.disabled=false;
  }
}
document.getElementById("unlock-button").addEventListener("click",unlock);
document.getElementById("password-input").addEventListener("keypress",e=>{if(e.key==="Enter") unlock();});
</script>
</body>
</html>
