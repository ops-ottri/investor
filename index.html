<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width,initial-scale=1,maximum-scale=1"
  />
  <title>Ottri Investor Update — Confidential</title>
  <meta name="robots" content="noindex,nofollow" />
  <style>
    :root{
      --bg:#0a0a12;--panel:#141425;--ink:#eae9ff;--muted:#9ca3af;--accent:#a78bfa;--danger:#f87171;
      --radius:18px
    }
    html,body{height:100%}
    body{
      margin:0;background:radial-gradient(1200px 600px at 50% -10%,#1f1b39 0%,#0a0a12 50%,#0a0a12 100%);
      color:var(--ink);font:500 15px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial
    }
    .center{min-height:100%;display:grid;place-items:center;padding:40px}
    .card{
      width:min(520px,92vw);background:var(--panel);border-radius:var(--radius);
      box-shadow:0 20px 60px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.03);
      padding:28px
    }
    h1{margin:0 0 8px;font-weight:800;font-size:22px;text-align:center}
    .subtitle{color:var(--muted);text-align:center;margin-bottom:18px}
    .row{display:flex;gap:10px}
    input[type="password"]{
      flex:1;background:#0f1020;border:1px solid #2a2a44;border-radius:12px;padding:14px 14px;
      color:var(--ink);font-weight:600;letter-spacing:.2em
    }
    button{
      background:linear-gradient(145deg,#7c66f2,#a78bfa);border:none;border-radius:12px;padding:0 16px;
      color:white;font-weight:800;cursor:pointer;min-height:46px
    }
    .hint{margin-top:10px;height:18px;color:var(--muted);font-size:13px;text-align:center;transition:opacity .25s}
    .hint.error{color:var(--danger)}
    /* app body hidden until unlock */
    #app-body{display:none}
    /* print deterrent */
    @media print {
      body{display:none !important}
    }
    /* subtle watermark */
    .wm{
      position:fixed;inset:0;pointer-events:none;opacity:.06;
      background:
        repeating-linear-gradient(25deg,transparent 0 120px, #fff 120px 121px),
        repeating-linear-gradient(-25deg,transparent 0 120px, #fff 120px 121px);
      mix-blend-mode:overlay
    }
  </style>
</head>
<body>

  <!-- ===== Gate ===== -->
  <div id="pw-gate" class="center" aria-hidden="false">
    <div class="card" role="dialog" aria-modal="true" aria-labelledby="ttl">
      <h1 id="ttl">Confidential — Access Required</h1>
      <div class="subtitle">Enter your password to view this update.</div>
      <div class="row" style="margin:12px 0 4px">
        <input id="pwInput" type="password" inputmode="latin" autocomplete="current-password" placeholder="••••" />
        <button id="pw-btn" aria-label="Unlock">Unlock</button>
      </div>
      <div id="pw-msg" class="hint" aria-live="polite"></div>
      <div class="hint">Do not share, print, or capture this page.</div>
    </div>
  </div>

  <!-- ===== App Body (hidden until unlocked) ===== -->
  <div id="app-body">
    <div class="wm"></div>
    <main style="max-width:1080px;margin:40px auto;padding:0 20px">
      <header style="display:flex;align-items:center;justify-content:space-between;margin-bottom:28px">
        <h2 style="margin:0;font-size:30px;font-weight:900">Ottri — Investor Update</h2>
        <span style="color:var(--muted)">Confidential</span>
      </header>

      <!-- Your content / sections go here. Keeps prior structure intact if you paste it here. -->
      <section id="content">
        <p style="color:var(--muted)">Unlocked. Replace this placeholder with your investor content.</p>
      </section>
    </main>
  </div>

  <!-- ===== Config + Unlock Logic ===== -->
  <script>
    /* ======== CONFIG ======== */
    // If you already generate window.__APP_JSON__ from Apps Script, leave this as-is.
    // Otherwise this placeholder keeps the code safe.
    window.__APP_JSON__ = window.__APP_JSON__ || {};

    // Tabs (kept for compatibility with your existing code)
    const TAB_ORDER   = ["title","intro","team","momentum","product","roadmap","market","partners","vision","footer","passwords"];
    const TITLE_TABS  = ["title","hero","header"];
    const FOOTER_TABS = ["footer","foot","end"];

    // Password source
    const PASSWORDS_TAB = "passwords"; // expects a 2D array at __APP_JSON__.passwords
    // Static fallback: "guyr"
    const STATIC_PASSWORD_SHA256 = "51de33c86d3470d68fb01cafbb5eb0d6b24ce424c309b2163ec581f2bd280368";

    /* ======== UTIL ======== */
    async function sha256Hex(txt){
      const buf = new TextEncoder().encode(txt);
      const hash = await crypto.subtle.digest("SHA-256", buf);
      return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,"0")).join("");
    }
    function collectSheetPasswords(sheetBlock){
      if(!Array.isArray(sheetBlock)) return [];
      const out=[];
      for(const row of sheetBlock){
        if(!row || !row.length) continue;
        const a = String(row[0] ?? "").trim();  // A = sha256 hex
        const c = String(row[2] ?? "").trim();  // C = optional ISO expiry
        if(!a) continue;
        if(c){
          const exp = new Date(c);
          if(isNaN(exp.getTime()) || Date.now() > +exp) continue;
        }
        out.push(a.toLowerCase());
      }
      return out;
    }
    async function tryUnlock(pw, payload){
      const enteredHash = (await sha256Hex(pw)).toLowerCase();
      const allowed = new Set();

      if(STATIC_PASSWORD_SHA256 && STATIC_PASSWORD_SHA256.trim()){
        allowed.add(STATIC_PASSWORD_SHA256.trim().toLowerCase());
      }
      try{
        const sheetBlock = payload?.[PASSWORDS_TAB];
        for(const h of collectSheetPasswords(sheetBlock)) allowed.add(h);
      }catch(e){ console.warn("Password sheet parse failed:", e); }

      return allowed.has(enteredHash);
    }

    /* ======== UI ======== */
    async function handleUnlockClick(){
      const input = document.getElementById("pwInput");
      const msg   = document.getElementById("pw-msg");
      const ok = await tryUnlock(input.value || "", window.__APP_JSON__);

      if(ok){
        document.getElementById("pw-gate").style.display = "none";
        document.getElementById("app-body").style.display = "block";
      }else{
        msg.textContent = "Invalid or expired password.";
        msg.classList.add("error");
        msg.style.opacity = 1;
        setTimeout(()=>{ msg.style.opacity = 0 }, 2400);
      }
    }

    document.addEventListener("DOMContentLoaded", ()=>{
      document.getElementById("pw-btn").addEventListener("click", handleUnlockClick);
      document.getElementById("pwInput").addEventListener("keydown", (e)=>{
        if(e.key === "Enter") handleUnlockClick();
      });

      // Confidentiality deterrents
      window.addEventListener("keydown",(e)=>{
        const p = (e.ctrlKey || e.metaKey) && (e.key.toLowerCase()==="p");
        const s = (e.ctrlKey || e.metaKey) && (e.shiftKey && e.key.toLowerCase()==="s");
        const c = (e.ctrlKey || e.metaKey) && (e.key.toLowerCase()==="c");
        if(p || s || c){ e.preventDefault(); e.stopPropagation(); }
      }, true);
      document.addEventListener("contextmenu",(e)=>e.preventDefault(), true);
      document.addEventListener("copy",(e)=>{ e.preventDefault(); }, true);
      window.onbeforeprint = ()=>{ document.body.style.display="none"; };
      window.onafterprint  = ()=>{ document.body.style.display="";  };
    });
  </script>
</body>
</html>
